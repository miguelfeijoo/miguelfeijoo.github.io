<!DOCTYPE html>
<html lang="sp">
    <head>
        <meta charset="utf-8">        
        <title>La realidad de Colombia con los Estupefacientes en el 2018. Las cifras hablan por sí solas.</title>

        <link href="https://fonts.googleapis.com/css?family=Lato:100,300,300i,400" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>        
    </head>

    <body> 


    <tr>
        <td>
            <svg class = c width="350" height="500"></svg>     
        </td>
        <td>
            <svg class = d width="350" height="500"></svg>        
        </td>
    </tr>

        <div class="container">
            <header>
            </header>

            <div class="hero-text-box">
                <h1>¿En verdad los Estupefacientes se detuvieron? ¡Las Cifras de la Policía Nacional - Antinarcóticos dicen lo contrario!</h1>
              
            </div>    
            <br>
            <p class="main-text">
                Desde finales de los años 60, Colombia ha tenido una economía subterránea basada en el tráfico de estupefacientes tanto a nivel nacional como internacional, la cual viene creciendo desde entonces; sin embargo, dada la reciente firma del acuerdo de paz con las Fuerzas Armadas Revolucionarias de Colombia - FARC y el constante trabajo de las Fuerzas Armadas de Colombia, se espera que el nivel de producción y distribución de estupefacientes a nivel nacional disminuya. 
            </p>
            
            <p class="main-text">                
                Según lo anterior, se realizó un análisis mediante visualizaciones de la base de datos
                <a href="https://www.datos.gov.co/Seguridad-y-Defensa/Incautacion-estupefacientes-2018/svze-44jj/data" target="_blank">Incautación estupefacientes 2018</a> disponible en el portal de <a href="https://www.datos.gov.co/" target="_blank">Datos Abiertos de Colombia</a>
                 , proporcionada por el Grupo Información de Criminalidad (GICRI) - DIJIN de la Policía Nacional, con el propósito de entender mejor el estado actual de cómo se distribuyen los estupefacientes a nivel nacional.
            </p>

            <h2>Cifras</h2>
            
                        <p class="main-text">            
                Como primera aproximación a los datos, se procedió a visualizar la cantidad de estupefacientes incautados en el 2016 por cada departamento, entre los cuales se debe prestar atención a los siguientes <strong>Nariño, Antioquia y Valle del Cauca, en los cuales se incautaron 58 , 31 y 27 toneladas respectivamente.</strong>
            </p>
            
            <p class="main-text">
                En mayor detalle se tiene que en Nariño el 98,6% del total de estupefacientes incautados corresponden a Cocaína, en el departamento de Antioquia se presenta una distribución principalmente entre Cocaína con el 60,1% y Marihuana con el 33,9% de las incautaciones, por último, en el departamento del Valle del Cauca de la cantidad de estupefacientes incautados predominaron la Marihuana con el 57,6%, seguido por la Cocaína con un 38,7%.
            </p>
            <!--<div id="viz1" class="grafica"></div>-->


            <script>  

                /*    
                d3.csv("data/CANTIDAD_INCAUTADA.csv", function(error, cantidad_incautaciones_mes) {
                if (error) throw error;
                cantidad_incautaciones_mes.forEach(function(d) {
                d['MES']= d[ 'MES' ],
                d['BASE DE COCA'] +d[ 'BASE DE COCA' ],
                d['BASUCO']= +d[ 'BASUCO' ],
                d['COCAINA']= d[ 'COCAINA' ],
                d['HEROINA']= +d[ 'HEROINA' ],
                d['MARIHUANA']= +d[ 'MARIHUANA' ]
                });
                */

                 
              cantidad_incautaciones_mes=d3.csv('https://raw.githubusercontent.com/miguelfeijoo/IncautacionesColombia2018/master/DATOS/CANTIDAD_INCAUTADA.csv', function ( d ) {
              return {
                'MES': d[ 'MES' ],
                'BASE DE COCA': +d[ 'BASE DE COCA' ],
                'BASUCO': +d[ 'BASUCO' ],
                'COCAINA': d[ 'COCAINA' ],
                'HEROINA': +d[ 'HEROINA' ],
                'MARIHUANA': +d[ 'MARIHUANA' ]
                
              };
            } )  
        


                console.log(cantidad_incautaciones_mes.then(d=>d).catch(d=>d).catch(d=>console.log(d.message)))

              

              var svg = d3.select( "svg.c" ),
                margin = { top: 50, right: 30, bottom: 30, left: 80 },
                iwidth = +svg.attr( "width" ) - margin.left - margin.right,
                iheight = +svg.attr( "height" ) - margin.top - margin.bottom,
                g = svg.append( "g" ).attr( "transform", "translate(" + margin.left + "," + margin.top + ")" );
              
              
              console.log(width)
              
              let tooltip = g.append("text")
                    .style("font-size", "10pt")
                    .style("font-family", "sans-serif")  
                    .style("color", "steelblue")
                    .attr("x", -100);
              let tooltip2 = g.append("text")
                    .style("font-size", "10pt")
                    .style("font-family", "sans-serif")  
                    .style("color", "steelblue")
                    .attr("x", -100);
              
              var x0 = d3.scaleBand()
                .rangeRound( [ 0, iwidth ] )
                .paddingInner( 0.3 );
              
              var x1 = d3.scaleBand()
                .padding( 0.05 );

              var y = d3.scaleLinear()
                .rangeRound( [ iheight, 0 ] );

              var rectangle = svg.append("rect").attr("id","rectangle")
                                        .attr("x", iwidth-380)
                                        .attr("y", iheight-400)
                                        .attr("width", 430)
                                        .attr("height", 30)
                                        .style("fill","none")
                                        .style('stroke','black');
                 
              var keys = cantidad_incautaciones_mes.columns.slice( 1 );
              
              var colors=["#3366cc", "#dc3912", "#ff9900", "#109618", "#990099", "#0099c6", "#dd4477", "#66aa00", "#b82e2e", "#316395", "#994499", "#22aa99", "#aaaa11", "#6633cc", "#e67300", "#8b0707", "#651067", "#329262", "#5574a6", "#3b3eac"];

            var n = 6;
            function shuffle(a) {
                for (let i = a.length; i; i--) {
                    let j = Math.floor(Math.random() * i);
                    [a[i - 1], a[j]] = [a[j], a[i - 1]];
                }
            }
            shuffle(colors);
              
              var z = d3.scaleOrdinal( colors.slice(0,n));
                
              x0.domain( cantidad_incautaciones_mes.map( d => d[ 'MES' ] ) );
              x1.domain( keys ).rangeRound( [ 0, x0.bandwidth() ] );
              y.domain( [ 0, d3.max( cantidad_incautaciones_mes, function(d) { return d3.max( keys, function( key ) { return d[ key ]; } ); } ) ] ).nice();
              
              g.append( "g" )
                .selectAll( "g" )
                .data( cantidad_incautaciones_mes )
                .enter().append( "g" )
                  .attr( "transform", d => "translate(" + x0( d[ 'MES' ] ) + ",0)" )
                .selectAll( "rect" )
                .data( function( d ) { return keys.map( function( key ) {  return { key: key, value: d[ key ] }; } ); } )
                .enter().append( "rect" )
                  .attr( "class", "bar" ).style("stroke-weigth",10).style("stroke","black")
                  .attr( "x", d => x1( d.key ) )
                  .attr( "y", d => y( d.value ) )
                  .attr( "width", x1.bandwidth())
                  .attr( "height", d => iheight - y( d.value ) )
                  .attr( "fill", d => z( d.key ) )
                  .on("mouseover", function( d ) {  
                
                  
                   
                    tooltip.attr("x", iwidth-360)
                    .attr("y", iheight-400)
                    .html(`Se registraron ${parseInt(d.value).toLocaleString()} GRAMOS incautados ese mes`)
                    .style('font-weight',"bold").style("fill", "firebrick").style("font-size",'12px');
                
                    tooltip2.attr("x", iwidth-360)
                    .attr("y", iheight-385)
                    .html(`Estupefaciente Incautado: ${d.key}`)
                    .style('font-weight',"bold").style("fill", "firebrick").style("font-size",'12px');
                
                        
                    d3.select( "svg" ).selectAll( "rect.bar" )
                      .select( function( di ) { return di.key !== d.key ? this : null ; } )
                      .transition()
                         .style( "opacity", "0.2" );
                    
                    var line = d3.line()
                      .x( dj => x0( dj[ 'MES' ] ) + x1( d.key ) + ( x1.bandwidth() / 2 ) )
                      .y( dj => y( dj[ d.key ] ) );
                
                console.log(cantidad_incautaciones_mes)
                    g.append( "path" )
                      .datum( cantidad_incautaciones_mes )
                      .attr( "class", "line" )
                      .attr( "fill", "none" )
                      .attr( "stroke", 'black' )
                      .attr( "stroke-width", 3 )
                      .attr( "d", line );
                     
                    g.selectAll( "circle" )
                      .data( cantidad_incautaciones_mes ).enter()   
                      .append( "circle" )
                        .attr( "cx", dj => x0( dj[ 'MES' ] ) + x1( d.key ) + ( x1.bandwidth() / 2 ) )
                        .attr( "cy",  dj => y( dj[ d.key ] ) )
                        .attr( "r", 4 )
                        .attr( "class", "circle" )
                        .attr( "fill", 'black' )
                        .attr( "stroke", "black" );
                    } )                 
                  .on( "mouseout", function( d ) {      
                    
                    
                    d3.select( "svg" ).selectAll( "rect" )
                      .select( function( di ) { console.log(di.key);return di.key !== d.key ? this : null ; } )
                      .transition()
                      .style( "opacity", "1" );
                     
                    tooltip.text("") .transition()
                    .duration(300)
                    tooltip2.text("") .transition()
                    .duration(300)
                    svg.selectAll( ".line" ).remove()
                    svg.selectAll( "circle.circle" ).remove()
                  } );
              
              g.append( "g" )
                  .attr( "class", "axis" )
                  .attr( "transform", "translate(0," + iheight + ")" )
                  .call( d3.axisBottom( x0 ) );
              
              console.log("adsfasfadsfadsf   "+y( 35000000 ) + 0.5)
              console.log("ticks    "+ y.ticks().pop())

              
              
              g.append( "g" )
                  .attr( "class", "axis" )
                  .call( d3.axisLeft( y ).ticks( null, ".0f" ) )
                .append( "text" )
                  .attr( "x", 2 )
                  .attr( "y", y( y.ticks().pop() ) + 0.5 )
                  .attr( "dy", "0.32em" )
                  .attr( "fill", "#000" )
                  .attr( "font-weight", "bold" )
                  .attr( "text-anchor", "start" )
                  .attr( "font-family", "sans-serif" )
                  .attr( "font-size", 8 )
                  .text( "Estupefacientes Incautados por Mes" )
                  .attr("transform", "rotate(-90) translate(-200,0)")
                  .style("font-size",11)
                  .attr("y", 10);
              
              var legend = svg.append( "g" )
                  .attr( "font-family", "sans-serif" )
                  .attr( "font-size", 12 )
                  .attr( "text-anchor", "end" )
                .selectAll( "g" )
                .data( keys.slice().reverse() )
                .enter().append( "g" )
                  .attr( "transform", ( d, i ) => "translate(" + i*70 + ",10)" );
              
              legend.append( "circle" )
                .attr( "class", "legend" )
                .attr("cx",( d, i ) => iwidth - ( i * 150 - 25 )).attr("cy",25).attr("r",10)
                .attr( "fill", z );
              
              legend.append( "text" )
                .attr( "x", ( d, i ) => iwidth - ( i * 150 -10) )
                .attr( "y", 25 )
                .attr( "dy", "0.5em" )
                .text( d => d ).style("font-size","8px").style('font-weight',"bold");



            

            </script>


            
            <p class="main-text">
                Continuando con el análisis, se procedió a visualizar el número de incautaciones realizadas por departamento, nuevamente destacaron por contar con el mayor número de incautaciones, los departamentos de <strong>Antioquia (40.953) y Valle del Cauca (27.733)</strong>, seguidos por <strong>Cundinamarca (12.263)</strong>. Se debe mencionar que a pesar de contar con la mayor cantidad de estupefacientes incautados (58.1 Toneladas) que el departamento de <strong>Nariño se ubica en la posición 12 a nivel nacional en el número de incautaciones con 1.448.</strong> 
            </p>
            
            <p class="main-text">                
                Teniendo en cuenta la tendencia predominante de tener una mayor presencia de estupefacientes en los departamentos de Nariño, Antioquia, Valle del Cauca y Cundinamarca, se realizó una visualización tipo Scatter Plot (o diagrama de dispersión) para explorar la relación entre las variables "Número de Incautaciones" y "Cantidad de estupefacientes incautados".
            </p>
            <!--<div id="d3_03_grafico" class="grafica"></div> -->
            
            <p class="main-text">            
                La visualización anterior permite identificar que los departamentos de Nariño, Antioquia, Valle del Cauca y Cundinamarca presentan un comportamiento atípico en comparación con los demás departamentos del país. Estos últimos no deben ser pasados por alto a pesar de contar con cifras mucho menores, ya que pueden ocultar una problemática que los datos analizados no reflejan.
            
            <h2>Conclusiones</h2>                
            <p class="main-text">            
                Se debe tener presente que los datos analizados corresponden a incautaciones de estupefacientes y no reflejan la intención de uso, ya sea consumo o distribución de los mismos. Sin embargo, se pudo tener un panorama general de la dinámica de los estupefacientes en los departamentos con mayor incidencia en este fenómeno. A continuación, se presentan los principales hallazgos basados en las visualizaciones presentadas.
            </p>
            
            





            <!--<script type="text/javascript" src="js/variables.js"></script> 
            <script type="text/javascript" src="js/group.js"></script> -->
                                       

            <footer>
                <p><br><br><strong>La realidad de Colombia con los Estupefacientes en el 2018. Las cifras halban por sí solas.</strong> es mantenido por <a href="https://github.com/miguelfeijoo/miguelfeijoo.github.io/tree/master/IncautacionesColombia2018" target="_blank">Miguel Alfonso Feijóo García</a>  -  201213419</p>
                <p>Publicado con <a href="https://pages.github.com" target="_blank">GitHub Pages</a></p>                        
            </footer>
        </div>
    </body>
</html>
