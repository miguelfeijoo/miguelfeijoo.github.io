<!--  DEPENDENCIES / STYLES   -->
<link rel="shortcut icon" href="favicon.ico">
<script type="text/javascript" src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="//golden-layout.com/assets/js/goldenlayout.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.21/angular.min.js"></script>
<link type="text/css" rel="stylesheet" href="//golden-layout.com/assets/css/goldenlayout-base.css" />
<link type="text/css" rel="stylesheet" href="//golden-layout.com/assets/css/goldenlayout-light-theme.css" />
<link rel='stylesheet' type='text/css' href='https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css' >
<link rel='stylesheet' type='text/css' href='https://cdn.datatables.net/buttons/1.5.2/css/buttons.dataTables.min.css' >
 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
   integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
   crossorigin=""/>
<link type="text/css" rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.9/leaflet.draw.css" />
<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
   integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
   crossorigin=""></script>
<script type="application/javascript" src="//cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.9/leaflet.draw.js"></script>
<script type="application/javascript" src="//unpkg.com/@turf/turf@latest/turf.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
<script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster-src.js"></script>
<script src='https://code.jquery.com/jquery-1.12.4.js'></script>
<script src='https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js'></script>
<script src='https://cdn.datatables.net/buttons/1.4.0/js/dataTables.buttons.min.js'></script>
<script src='https://cdn.datatables.net/buttons/1.4.0/js/buttons.flash.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js'></script>
<script src='https://cdn.datatables.net/buttons/1.4.0/js/buttons.html5.min.js'></script>
<script src='https://cdn.datatables.net/buttons/1.4.0/js/buttons.print.min.js'></script>
<script src="https://cdn.jsdelivr.net/npm/vega@4.3.0"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@3.0.0-rc8"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@3.20.0"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="js/xlsx.full.min.js"></script>
<script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://unpkg.com/popper.js@1.14/dist/umd/popper.min.js"></script>
<script src="https://unpkg.com/navio/dist/navio.min.js"></script>




<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.5.0/math.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.5.0/math.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.5.0/math.min.map"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/regression/1.4.0/regression.min.js"></script>
<script type="text/javascript" src="https://cdn.anychart.com/releases/8.5.0/js/anychart-base.min.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">


<meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=yes">
<title>S-PLOR-T</title>
<link rel="stylesheet" href="https://js.arcgis.com/3.27/dijit/themes/claro/claro.css">
<link rel="stylesheet" href="css/app.css">
<link rel="stylesheet" href="css/fileupload.css">
<link rel="stylesheet" href="https://js.arcgis.com/3.27/esri/css/esri.css">
<link rel="stylesheet" href="https://js.arcgis.com/3.27/esri/themes/calcite/dijit/calcite.css">
<link rel="stylesheet" href="https://js.arcgis.com/3.27/esri/themes/calcite/esri/esri.css">
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://js.arcgis.com/3.27/"></script>


<!--  TEMPLATE FOR EACH MODULE/VIEW   -->
<template type="text/html" id="fileselectorTemplate">
  <div id='selector' ng-controller="fileselectorController" class="fileselector">
  		<span style=" float:left; padding-left:2%;">
		<p><strong><font size="3">Select a file of your interest to analyze its current attributes </font></strong><p></p>(Accepted Extensions: <i>.csv, .xls, .xlsx</i> )</p>
		<p></p>
		<input ng-model='shared.current_data' type="file" accept=".csv,.xlsx,.xls" id="files" name="file" />
		<div id='buttonComplete' align='left'></div>
		<div id="tableGoesHere"align="center"></div>	
		</span>			
</template>	

<template type="text/html" id="navioTemplate">
    <div id='navio_widget' ng-controller="navioController" class="navio">
    	<p></p>
    	<div id="navio"></div>
    </div>
</template>	

<template type="text/html" id="spatioTemplate">
    <div id='spatial_id' ng-controller="spatioController" class="spatialviz">
    	<span style=" float:left; padding-left:2%;">
		<p></p>
		<div id="text" align="left"></div>
		<p></p>
		<div id="list" align="left"></div>
		<p></p>
		<div id="list2" align="left"></div>
		<p></p>
		<p></p>
		<div id="btn1" align="left"></div>
		<p></p>
		<p></p>
		<div id="spatial"align="center"></div>
	</span>
    </div>
</template>	

<template type="text/html" id="temporalTemplate">
	<div id='temporal_id' ng-controller="temporalController" class="temporalviz">
		<span style=" float:left; padding-left:2%;"> 
	 	<p></p>
	 	<div id="list3" align="left"></div>
	 </span>
		<p></p>
    </div>
</template>	

<template type="text/html" id="boxplotTemplate">
	<div id='boxplotid' ng-controller="boxplotController" class="boxplot">
		<span style=" float:left; padding-left:2%;"> 
		<p></p>
		<div id="list4" align="left"></div>		
		<div id="boxplot"></div>
		<p></p>
		<div id="list5" align="left"></div>	
		<p></p>				
		<div id="counter" align="left"></div>	
	</span>
	</div>
</template>

<template type="text/html" id="mapTemplate">
	<div id='mapid' ng-controller="mapController" class="map" align='center'>	
		<div id='mapOPENid'></div>
	</div>
</template>

<template type="text/html" id="mapESRITemplate">
	<div id='mapESRIid' ng-controller="mapESRIController" class="mapESRI" align='center'>	
		 <body class="calcite">
		    <div id="mainWindow" data-dojo-type="dijit/layout/BorderContainer" data-dojo-props="design:'headline',gutters:false">
		      <div data-dojo-type="dijit/layout/ContentPane" id="rightPane" data-dojo-props="region:'top'">
		          <span style=" float:left; padding-left:2%;">
		          <font size="3"><p align='left'><strong>First select a file in the container "FILE PICKER"</strong></p><p align='left'>Then, add a <strong>"ZIPPED SHAPEFILE"</strong> on the map</p><p align='left'>Visit the
		            <a target='_blank' href="https://doc.arcgis.com/en/arcgis-online/reference/shapefiles.htm">Shapefiles</a> help topic for information and limitations.</p></font>
		              <form enctype="multipart/form-data" method="post" id="uploadForm"  align='left'>
		              <div class="field">
		                  <label class="file-upload">
		                      <span><strong>Add File</strong></span>
		                      <input type="file" name="file" id="inFile" />
		                  </label>
		              </div>
		              </form>
		              <span class="file-upload-status" style="opacity:1;" id="upload-status"></span>
		              <div id="fileInfo">&nbsp;</div>
		     	</span>
		    </div>
		    <div id="mapCanvas" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'center'" align='center'>
				<div id="info">
				<div><strong>Select one of the following shapes and then draw on map to add graphic as desired:</strong></div>					
					<p></p>
					<button id="Point">Point</button>
					<p></p>
					<button id="Multipoint">Multipoint</button>
					<p></p>
					<button id="Line">Line</button>
					<p></p>
					<button id="Polyline">Polyline</button>
					<p></p>
					<button id="FreehandPolyline">Freehand Polyline</button>
					<p></p>
					<button id="Triangle">Triangle</button>
					<p></p>
					<button id="Extent">Rectangle</button>
					<p></p>
					<button id="Circle">Circle</button>
					<p></p>					
					<button id="Polygon">Polygon</button>
					<p></p>
					<button id="FreehandPolygon">Freehand Polygon</button>
					<p></p>
				</div>
		    	<div id="search"></div>
		    </div>

		  </div>
		  </body>
				
	</div>
</template>

<template type="text/html" id="splomTemplate">	
	<div id='splomid' ng-controller="splomController" class="splom">
		<span style=" float:left; padding-left:2%;">
		<p></p>
		<div id="list6" align="left"></div>
		<p></p>
		<div id="list7" align="left"></div>
		<p></p>
		<div id="btn_complete_splom" align="left"></div>
		<p></p>
		<div id="splomGraph"align="center"></div>
	</span>
	</div>
</template>

<template type="text/html" id="regressionTemplate">	
	<div id='regressionid' ng-controller="regressionController" class="regression">
		<span style=" float:left; padding-left:2%;">
		<p></p>
		<div id="list8" align="left"></div>
		<p></p>
		<div id="list9" align="left"></div>
		<p></p>
		<div id="regressionGraph" align="left"></div>
	</span>
	</div>
</template>

<template type="text/html" id="bubbleTemplate">	
	<span style=" float:left; padding-left:2%;">
	<div id='bubbleid' ng-controller="bubbleController" class="bubble">			
		<p></p>
		<div id="list10" align="left"></div>
		<p></p>
		<div id="bubbleGraph"align="center"></div>
	</div>
</span>
</template>

<template type="text/html" id="ESRI_OSM_Template">	
	<div id='ESRI_OSM_id' ng-controller="ESRI_OSM_Controller" class="ESRI_OSM">
	</div>
</template>


<!-- PRELIMINARY CONTENT STYLE -->

<style type="text/css">
	body .lm_content{
	  overflow: scroll;
	}	
	#mapid { margin: 0px; height: 100%; width: 100% }
	#boxplotid { margin: 0px; height: 100vh; width: 100vw }
	#splomid { margin: 0px; height: 100%; width: 100% }
	#regressionid { margin: 0px; height: 100%; width: 100% }
	#temporal_id { margin: 15px; height: 100%; width: 100% }
	#spatial_id { margin: 15px; height: 100%; width: 100% }
	#navio { margin: 15px; height: 100%; width: 100% }
	#selector { margin: 15px; height: 100%; width: 100% }
	#mainWindow { margin: 0px; height: 97vh; width: 97vw }
	#mapCanvas{ margin: 0px; height: 97vh; width: 97vw }
	#boxplot { margin: 0px; width: 100vw }
	#regressionGraph { margin: 0px; width: 100vw }
	#bubbleid { margin: 0px; height: 100vh; width: 100vw }

.switch {
        position: relative;
        display: inline-block;
        width: 100px;
        height: 34px;
      }

      .switch input {display:none;}

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ca2222;
        -webkit-transition: .4s;
        transition: .4s;
      }

      .slider.round {
        border-radius: 34px;
      }

      .slider.round:before {
        border-radius: 50%;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        -webkit-transition: .4s;
        transition: .4s;
      }

      input:checked + .slider {
        background-color: #2ab934;
      }

      input:focus + .slider {
        box-shadow: 0 0 1px #2196F3;
      }

      input:checked + .slider:before {
        -webkit-transform: translateX(68px);
        -ms-transform: translateX(68px);
        transform: translateX(68px);
      }

      .on
      {
        display: none;
      }

      .on, .off
      {
        color: white;
        position: absolute;
        transform: translate(-50%,-50%);
        top: 50%;
        left: 50%;
        font-size: 10px;
        font-family: Verdana, sans-serif;
      }

      input:checked+ .slider .on
      {display: block;}

      input:checked + .slider .off
      {display: none;}	

</style>


<script type="text/javascript">
	var fileselectorApp = angular.module('fileselector', ['test-service'] );
	var navioApp = angular.module('navio', ['test-service'] );
	var spatioApp = angular.module('spatialviz', ['test-service'] );
	var temporalApp = angular.module('temporalviz', ['test-service'] );
	var boxplotApp = angular.module('boxplot', ['test-service'] );
	var mapApp = angular.module('map', ['test-service'] );
	var splomApp = angular.module('splom', ['test-service'] );
	var regressionApp = angular.module('regression', ['test-service'] );
	var mapESRIApp = angular.module('mapESRI', ['test-service'] );
	var bubbleApp = angular.module('bubble', ['test-service'] );
	var ESRI_OSMApp = angular.module('ESRI_OSM', ['test-service'] );
	angular.module('test-service', []).service('TestService', function($rootScope, $window){
	  var datos= null;
	  var seq= null;
	  var cat= null;
	  $window.rootScopes = $window.rootScopes || [];
	    $window.rootScopes.push($rootScope);
	   if (!!$window.sharedService){
	      return $window.sharedService;
	    }
	    
	    $window.sharedService = {      
	      get: function(){
	        return datos;
	      },
	      getData: function(callback) {
		  	$(function()
			{
				$('#files').change( function(event) {
				console.log(event.target.files[0].name)
				var tmppath = URL.createObjectURL(event.target.files[0]);
				console.log(tmppath)
				var fmt1 = d3.timeParse("%m/%d/%Y %H:%M:%S %p");
				var fmt2 = d3.timeParse("%m/%d/%Y %H:%M:%S ");
				var fmt3 = d3.timeParse("%m/%d/%Y %H:%M");
				var fmt4 = d3.timeParse("%d/%m/%Y %H:%M:%S %p");
				var fmt5 = d3.timeParse("%d/%m/%Y %H:%M:%S ");
				var fmt6 = d3.timeParse("%d/%m/%Y %H:%M");
				var fmt7 = d3.timeParse("%Y/%m/%d %H:%M:%S %p");
				var fmt8 = d3.timeParse("%Y/%m/%d %H:%M:%S ");
				var fmt9 = d3.timeParse("%Y/%m/%d %H:%M");
				var fmt10 = d3.timeParse("%m-%d-%Y %H:%M:%S %p");
				var fmt11 = d3.timeParse("%m-%d-%Y %H:%M:%S ");
				var fmt12 = d3.timeParse("%m-%d-%Y %H:%M");
				var fmt13 = d3.timeParse("%d-%m-%Y %H:%M:%S %p");
				var fmt14 = d3.timeParse("%d-%m-%Y %H:%M:%S ");
				var fmt15 = d3.timeParse("%d-%m-%Y %H:%M");
				var fmt16 = d3.timeParse("%Y-%m-%d %H:%M:%S %p");
				var fmt17 = d3.timeParse("%Y-%m-%d %H:%M:%S ");
				var fmt18 = d3.timeParse("%Y-%m-%d %H:%M");
				function parsing(d){					
							if (d.hasOwnProperty("Latitud")){
							     d["Latitude"] = +d["Latitud"];
							    delete d["Latitud"];
							}
							if(d.hasOwnProperty("latitud")){
							    d["Latitude"] = +d["latitud"];
							    delete d["latitud"];
							}
							if(d.hasOwnProperty("X")){
							    d["Latitude"] = +d["X"];
							    delete d["X"];
							}
							if(d.hasOwnProperty("x")){
							    d["Latitude"] = +d["x"];
							    delete d["x"];
							}
							if (d.hasOwnProperty("Longitud")){
							     d["Longitude"] = +d["Longitud"];
							    delete d["Longitud"];
							}
							if(d.hasOwnProperty("longitud")){
							    d["Longitude"] = +d["longitud"];
							    delete d["longitud"];
							}
							if(d.hasOwnProperty("Y")){
							    d["Longitude"] = +d["Y"];
							    delete d["Y"];
							}
							if(d.hasOwnProperty("y")){
							    d["Longitude"] = +d["y"];
							    delete d["y"];
							}
							if (!d.hasOwnProperty("Latitude") && !d.hasOwnProperty("Longitude")){
							 var x=Object.keys(d)
							 for(var i=0;i<x.length;i++){
							  //console.log(d[x[i]])
							  if (/(\()?(\-)?([0-9]){1,3}(\.){1}([0-9]){2,10}( )?(\,)?(\;)?(\-)?( )?(\-)?([0-9]){1,3}(\.){1}([0-9]){1,10}(\))?/.test(d[x[i]])){
							    d['Latitude']=+d[x[i]].split(',')[0].split('(')[1]
							    d['Longitude']=+d[x[i]].split(',')[1].split(')')[0]
							    delete d[x[i]];					        
							  }
							 }
							}
							if (d.hasOwnProperty("Fecha")){
							d["Date"] = d["Fecha"];
							delete d["Fecha"];
							if (/[a]{1}\.( )?[m]{1}\./.test(d.Date)){
							d.Date = d.Date.replace(/[a]{1}\.( )?[m]{1}\./, "AM");
							seqColumnsconsole.log(d.Date)
							}
							else if (/[p]{1}\.( )?[m]{1}\./.test(d.Date)){
							d.Date = d.Date.replace(/[p]{1}\.( )?[m]{1}\./, "PM");
							console.log(d.Date)
							} 
							}
							else if (d.hasOwnProperty("fecha")){
							d["Date"] = d["fecha"];
							delete d["fecha"];
							if (/[a]{1}\.?( )[m]{1}\.\./.test(d.Date)){
							d.Date = d.Date.replace(/[a]{1}\.?( )[m]{1}\./, "AM");
							}
							else if (/[p]{1}\.?( )[m]{1}\./.test(d.Date)){
							d.Date = d.Date.replace(/[p]{1}\.?( )[m]{1}\./, "PM");
							} 
							}
							// This function is applied to each row of the dataset
							if(fmt1(d.Date)!=null){
							  d.Date = fmt1(d.Date);
							}
							else if (fmt2(d.Date)!=null){
							  d.Date = fmt2(d.Date);
							}
							else if (fmt3(d.Date)!=null){
							  d.Date = fmt3(d.Date);
							}
							else if (fmt4(d.Date)!=null){
							  d.Date = fmt4(d.Date);
							}
							else if (fmt5(d.Date)!=null){
							  d.Date = fmt5(d.Date);
							}
							else if (fmt6(d.Date)!=null){
							  d.Date = fmt6(d.Date);
							}
							else if (fmt7(d.Date)!=null){
							  d.Date = fmt7(d.Date);
							}
							else if (fmt8(d.Date)!=null){
							  d.Date = fmt8(d.Date);
							}
							else if (fmt9(d.Date)!=null){
							  d.Date = fmt9(d.Date);
							}
							else if (fmt10(d.Date)!=null){
							  d.Date = fmt10(d.Date);
							}
							else if (fmt11(d.Date)!=null){
							  d.Date = fmt11(d.Date);
							}
							else if (fmt12(d.Date)!=null){
							  d.Date = fmt12(d.Date);
							}
							else if (fmt13(d.Date)!=null){
							  d.Date = fmt13(d.Date);
							}
							else if (fmt14(d.Date)!=null){
							  d.Date = fmt14(d.Date);
							}
							else if (fmt15(d.Date)!=null){
							  d.Date = fmt15(d.Date);
							}
							else if (fmt16(d.Date)!=null){
							  d.Date = fmt16(d.Date);
							}
							else if (fmt17(d.Date)!=null){
							  d.Date = fmt17(d.Date);
							}
							else if (fmt18(d.Date)!=null){
							  d.Date = fmt18(d.Date);
							}
							
							var weekday = new Array(7);
							weekday[0] =  "Sunday";
							weekday[1] = "Monday";
							weekday[2] = "Tuesday";
							weekday[3] = "Wednesday";
							weekday[4] = "Thursday";
							weekday[5] = "Friday";
							weekday[6] = "Saturday";
							var month = new Array(12);
							month[0] = "January";
							month[1] = "February";
							month[2] = "March";
							month[3] = "April";
							month[4] = "May";
							month[5] = "June";
							month[6] = "July";
							month[7] = "August";
							month[8] = "September";
							month[9] = "October";
							month[10] = "November";
							month[11] = "December";
							function weekMonth(date) {						    
							    var prefixes = ['First', 'Second', 'Third', 'Fourth', 'Fifth'];
							    return prefixes[Math.floor(date.getDate() / 7)];
							}
							
							if (d.hasOwnProperty("Date")){
								d.Hours = d.Date.getHours();
								d.Minutes = d.Date.getMinutes();
								d.Seconds = d.Date.getSeconds();
								d.DayNight = d.Hours < 6 || d.Hours>18 ? "night": "diurnal";
								d.WeekOfTheMonth = weekMonth(d.Date)
								d.DayOfTheWeek = weekday[d.Date.getDay()];	
								if(!(d.DayOfTheWeek=='Sunday' || d.DayOfTheWeek=="Saturday")){
									d.isWeekDay="Yes"
								}	
								else{
									d.isWeekDay="No"
								}				
								d.Year = d.Date.getFullYear().toString();
								d.Month = month[d.Date.getMonth()];
								d.Day = d.Date.getDate();
							}
							return d;
				}
				if(event.target.files[0].name.includes(".xlsx") || event.target.files[0].name.includes(".xls")){
					/* set up XMLHttpRequest */
					var url = tmppath;
					var oReq = new XMLHttpRequest();
					oReq.open("GET", url, true);
					oReq.responseType = "arraybuffer";
					oReq.onload = function(e) {
					  var arraybuffer = oReq.response;
					  /* convert data to binary string */
					  var data = new Uint8Array(arraybuffer);
					  var arr = new Array();
					  for(var i = 0; i != data.length; ++i) arr[i] = String.fromCharCode(data[i]);
					  var bstr = arr.join("");
					  /* Call XLSX */
					  var workbook = XLSX.read(bstr, {type:"binary"});
					  /* DO SOMETHING WITH workbook HERE */
					  var first_sheet_name = workbook.SheetNames[0];
					  /* Get worksheet */
					  var worksheet = workbook.Sheets[first_sheet_name];
					  var dats= XLSX.utils.sheet_to_json(worksheet,{raw:true});
					  var cols = Object.keys(dats[0]);
					  console.log(cols.indexOf('Time'))
					  
					  cols=cols.slice(0,cols.indexOf('Time'))

					  var dats_callback=[]
					 
										  
						var transpose = dats.reduce(function(arr, obj) {
							for (let key in obj) {
								if (obj.hasOwnProperty(key)) {
									arr[key] = arr[key] || []
									arr[key].push(obj[key])
								}
							}
							return arr
						}, {})




						var myJsonString = JSON.stringify(transpose);


						//var array_json=JSON.parse(myJsonString)
						var x=[]
						
						for(var i=0;i<myJsonString.split(',').length;i++){
							
							x.push(myJsonString.split(',')[i].split(':['))					

						}


						var y=[]

						for(var k=0;k<x.length;k++){
							if(x[k].length>1){
								x[k]=x[k][1]
								if(x[k].includes(']')){
									if(!x[k].includes('a')){										
										x[k]=x[k].split(']')[0]
									}									
								}
								if(x[k].includes('"')){
									x[k]=x[k].split('"')[1]
								}
								if(x[k].includes('a')){
									y.push(x[k])
								}
								else{
									y.push(parseFloat(x[k]))
								}	
							}
							else{
								x[k]=x[k][0]

								if(x[k].includes(']')){
									if(x[k].includes('a')){	
										console.log("..")
									}
									else{
										x[k]=x[k].split(']')[0]
									}									
								}
								if(x[k].includes('"')){
									x[k]=x[k].split('"')[1]
								}	
								if(x[k].includes('a')){
									y.push(x[k])
								}
								else{
									y.push(parseFloat(x[k]))
								}															
							}				
						}

						function chunkArrayInGroups(arr, size) {
						  var myArray = [];
						  for(var i = 0; i < arr.length; i += size) {
						    myArray.push(arr.slice(i, i+size));
						  }
						  return myArray;
						}		


						
						var chunks=chunkArrayInGroups(y,dats.length)	

						for(var i=0;i<chunks.length;i++){
							chunks[i].push(i)
						}	

						console.log(chunks)

						var json=[]
						for(var i=0;i<chunks.length;i++){
							for(var x=0;x<chunks[i].slice(0,chunks[i].length-1).length;x++){	
								if(i!=chunks.length-1){											
									json.push({'Year':(chunks[i][chunks[i].length-1]).toString(),'Value':chunks[i][x],'Time':chunks[chunks.length-1][x]})
								}
							}								
						}	

			     		for(var i=0;i<json.length;i++){	

			     				//console.log(dats[i])

							  	if(json[i].hasOwnProperty('Time')){
							  		json[i]['Name']=json[i]['Time'].split(']')[0].split('[')[0]							  		
							  		if((json[i]['Time'].split(',')).length ==3){
							  			if(json[i]['Time'].split(']')[0].split('[')[1].split(',')[0].split('a')[1].length>1){
							  				json[i]['Shape']="a-"+json[i]['Time'].split(']')[0].split('[')[1].split(',')[0].split('a')[1]
							  			}
							  			else{
							  				json[i]['Shape']="a-"+json[i]['Time'].split(']')[0].split('[')[1].split(',')[0].split('a')[1]
							  			}
							  			
							  			json[i]['Status']=json[i]['Time'].split(',')[2].split(']')[0]
							  			json[i]['Type']=json[i]['Time'].split(',')[1]  	
							  			
							  		}
							  		if((json[i]['Time'].split(',')).length ==2){
						  				if(json[i]['Time'].split(']')[0].split('[')[1].split(',')[0].split('a')[1].length>1){
							  				json[i]['Shape']="a-"+json[i]['Time'].split(']')[0].split('[')[1].split(',')[0].split('a')[1]
							  			}
							  			else{
							  				json[i]['Shape']="a-"+json[i]['Time'].split(']')[0].split('[')[1].split(',')[0].split('a')[1]
							  			}
						  				json[i]['Type']=json[i]['Time'].split(',')[1].split(']')[0]			  								  			
							  		}
							  		if((json[i]['Time'].split(',')).length ==1){
							  			if(json[i]['Time'].split(']')[0].split('[')[1].split(',')[0].split('a')[1].length>1){
							  				json[i]['Shape']="a-"+json[i]['Time'].split(']')[0].split('[')[1].split(',')[0].split('a')[1]
							  			}
							  			else{
							  				json[i]['Shape']="a-"+json[i]['Time'].split(']')[0].split('[')[1].split(',')[0].split('a')[1]
							  			}
							  		}	  									  		
							  								  		
							  		delete json[i]['Time'];				  		
							  		
							  	}
							  	dats_callback.push(json[i])
					   }
	
					 			
					  callback(dats_callback);
				}
					oReq.send();
				}
				else if(event.target.files[0].name.includes(".csv")){
					console.log("va a leer")
					d3.csv(tmppath, function (d) { 
							parsing(d)
							return d;
							},  function (err, data) {	
							 	dat=data;								 					 	
							 	callback(dat);							 	
							})
					};			
				});				
				});	
		}, changeData: function(newArr){
	        datos = newArr;
	        angular.forEach($window.rootScopes, function(scope) {
	          if(!scope.$$phase) {
	              scope.$apply();
	          }
	        });
	        return datos;
	      }, getSeqColumns: function(){
	        return seq;
	      }, changeSeqColumns: function(newArr){
	        seq = newArr;
	        angular.forEach($window.rootScopes, function(scope) {
	          if(!scope.$$phase) {
	              scope.$apply();
	          }
	        });
	        return seq;
	      }, getCatColumns: function(){
	        return cat;
	      }, changeCatColumns: function(newArr){
	        cat = newArr;
	        angular.forEach($window.rootScopes, function(scope) {
	          if(!scope.$$phase) {
	              scope.$apply();
	          }
	        });
	        return cat;
	      }
	    }
	    return $window.sharedService;
	})
	fileselectorApp.controller('fileselectorController', ["$scope",'$timeout',"container","state","TestService",function($scope,$timeout,container,state, TestService) {			
		
			$scope.dat= state.dat || null;
			$scope.datos= state.datos || null;
			$scope.dataFinal= state.dataFinal || null;
			$scope.seq= state.seq || null;
			$scope.seqColumns= state.seqColumns || null;
			$scope.seqColumnsFinal= state.seqColumnsFinal || null;
			$scope.cat= state.cat || null;
			$scope.catColumns= state.catColumns || null;
			$scope.catColumnsFinal= state.catColumnsFinal || null;
			TestService.getData(function(d){
				$scope.dat =d;
				container.layoutManager.eventHub.emit( 'completedata', $scope.dat );
				var parse=[];
		    	var dateparse=[];
		   		var categoric=[];
				function json2table(json, classes) {

				console.log(json)
				var cols = Object.keys(json[0]);
				console.log(cols)
				  
				var headerRow = '';
				var bodyRows = '';
				var columnas='';
				var columnasSeq='';
				var columnsSequential=[];
				var columns=[];
				  
				classes = classes || '';
				function capitalizeFirstLetter(string) {
				    return string.charAt(0).toUpperCase() + string.slice(1);
				}
				  
				json.map(function(row) {
				    bodyRows += '<tr>';
				    cols.map(function(colName) {
				      bodyRows += '<td>' + row[colName] + '</td>';
				      columns.push(row[colName])
				      //console.log(cols.length)
				    })
					bodyRows += '</tr>';
				});
				for (i = 0; i < cols.length; i++){
				    if(/^[+-]?([0-9]*[.])?[0-9]+$/.test(columns[i]))
				    { 
				     parse.push(cols[i])
				    }
				    else if(/([0-9]{0,4})([0-9]{0,4})?(\/)([0-9]{0,4})([0-9]{0,4})?(\/)(\d{0,4})/.test(columns[i]))
				    {
				      dateparse.push(cols[i])
				    } 
				    else if(/[GMT-]{4}[0-9]{4}/.test(columns[i]))
				    {
				      dateparse.push(cols[i])
				    }  
				    else
				    {
				      categoric.push(cols[i])
				    }
				}
				if(parse.includes('Year') && categoric.includes('Year')){
				    var value = 'Year'
				    parse=parse.filter(function(item) { 
				    return item !== value
				 })}
				$scope.seq=parse.filter((value, index, self) => self.indexOf(value) === index);		
				
				for (var i=0;i<dateparse.length;i++){
				       $scope.seq.push(dateparse[i])      
				  }
				container.layoutManager.eventHub.emit( 'dateParseEvent', dateparse );
				$scope.cat=categoric.filter((value, index, self) => self.indexOf(value) === index);
				container.layoutManager.eventHub.emit( 'categoricsEvent', $scope.cat );
				cols.map(function(col) {
				headerRow += '<th>' + capitalizeFirstLetter(col) + '</th>';
				columnas += '<option value="'+col+'">'
				});	
				console.log(dateparse)
				
				$scope.seq.map(function(col) {							
							if (!(col=="Year" ||  col=="Day" || col=="DayNight" || col=="Minutes" || col=="Month" || col=="DayOfTheWeek" || col=="Latitude" || col=="Longitude" || col=="DayNight" || col=="Date" || col=="Hours" || col=="Seconds" || col=='__seqId'|| col=='__i'||dateparse.includes(col))){
									if(!($scope.cat).includes(col)){
										console.log(col)									
										columnsSequential.push('<option value="'+col+'">')	
									}
							}		
									
						columnsSequential=columnsSequential.filter((value, index, self) => self.indexOf(value) === index)
						columnasSeq=columnsSequential.join('')	
					});
				
				//console.log(columnasSeq)
				container.layoutManager.eventHub.emit( 'columnas_list', columnas );
				container.layoutManager.eventHub.emit( 'columnasSeq_list', columnasSeq );

				return '<table id="data" class="display nowrap" style="width:100%">'+'<thead><tr>' +
				     headerRow +
				     '</tr></thead><tbody>' +
				     bodyRows +
				     '</tbody></table>';
				}
				document.getElementById('tableGoesHere').innerHTML = json2table($scope.dat, 'table');
				$(document).ready(function() {
					$('#data').DataTable( {  
		    			"scrollY": 300,
		    			"scrollX": true
		    		} );
				} );
				
				function loadScript(src) {
				       var script = document.createElement("script");
				       script.type = "text/javascript";
				       document.getElementById("tableGoesHere").appendChild(script);
				       script.src = src;		      
				}
				function loadStyle(src) {
				       var script = document.createElement("link");
				       script.rel = 'stylesheet'
				       script.type = "text/css";
				       document.getElementById("tableGoesHere").appendChild(script);
				       script.href = src;
				}
				$(document).ready(function() {
				$('#data').DataTable( {
					destroy: true,
				    dom: 'lBfrtip',
				    buttons: [
				        'copy', 'csv', 'excel', 'pdf', 'print'
				    ],
				    "scrollY": 300,
		    		"scrollX": true
				} );
				} );
				loadStyle('https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css')
				loadStyle('https://cdn.datatables.net/buttons/1.5.2/css/buttons.dataTables.min.css')
				loadScript('https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js')
				loadScript('https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js')
				loadScript('https://cdn.datatables.net/buttons/1.5.2/js/buttons.flash.min.js')
				loadScript('https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js')
				loadScript('https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js')
				loadScript('https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js')
				loadScript('https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js')
				loadScript('https://cdn.datatables.net/buttons/1.5.2/js/buttons.print.min.js')
				var script = document.createElement("script");
				script.text="var table; $(document).ready(function() {$('#visible').DataTable( {destroy: true,paging: true, searching: true, dom: 'lBfrtip', buttons: ['copy', 'csv', 'excel', 'pdf', 'print']} );} );"
				document.getElementById("tableGoesHere").appendChild(script);
				otherfunction();

				
					container.layoutManager.eventHub.on( 'datachanged', function(returnData){
					container.layoutManager.eventHub.on( 'actual_upz',function(actual_upz){
						console.log(actual_upz)						
							if(returnData.filter(x=> parseInt(x.UPZ) === parseInt(actual_upz)).length>0){
								returnData=returnData.filter(x=> parseInt(x.UPZ) === parseInt(actual_upz))		
								container.layoutManager.eventHub.emit('redrawVisibleData',returnData)	
							}							
						})
					})

				container.layoutManager.eventHub.on( 'redrawVisibleData', function(returnData){		

					console.log(returnData)
					document.getElementById('tableGoesHere').innerHTML = json2table(returnData, 'table');
					$(document).ready(function() {
						$('#data').DataTable( {  
							destroy: true,
						    dom: 'lBfrtip',
						    buttons: [
						        'copy', 'csv', 'excel', 'pdf', 'print'
						    ],
			    			"scrollY": 300,
			    			"scrollX": true
			    		} );
					});				
					
				})
			})	

			function otherfunction(){
				$scope.datos=$scope.dat
				$scope.seqColumns=$scope.seq
				$scope.catColumns=$scope.cat
				container.layoutManager.eventHub.emit( 'datosiniciales', $scope.datos );
				container.layoutManager.eventHub.emit( 'seqiniciales', $scope.seqColumns );
				container.layoutManager.eventHub.emit( 'catiniciales', $scope.catColumns );
			}
			container.layoutManager.eventHub.on( 'datosiniciales', function( datosiniciales ){
				container.layoutManager.eventHub.on( 'seqiniciales', function( seqiniciales ){
					container.layoutManager.eventHub.on( 'catiniciales', function( catiniciales ){
				$scope.data=jQuery.extend(true, [], datosiniciales);
				$scope.dataFinal=TestService.changeData($scope.data)
				$scope.dataFinal=TestService.get();
				$scope.seqCols=jQuery.extend(true, [], seqiniciales);
				$scope.seqColumnsFinal=TestService.changeSeqColumns($scope.seqCols)
				$scope.seqColumnsFinal=TestService.getSeqColumns();
				$scope.catCols=jQuery.extend(true, [], catiniciales);
				$scope.catColumnsFinal=TestService.changeCatColumns($scope.catCols)
				$scope.catColumnsFinal=TestService.getCatColumns();		
				container.layoutManager.eventHub.emit( 'datos', $scope.dataFinal );
				container.layoutManager.eventHub.emit( 'seqColumns', $scope.seqColumnsFinal );
				container.layoutManager.eventHub.emit( 'catColumns', $scope.catColumnsFinal );
						})
					})
				})	


			container.layoutManager.eventHub.on( 'datos', function( data ){
					document.getElementById('buttonComplete').innerHTML='<p></p><p></p><button type="button" id="complete_data_btn"> <strong>SHOW ('+data.length+' VALUES)</strong></button><p></p><p></p><p></p><p></p>'	
					$('button[id="complete_data_btn"]').click(function() {  	
											
						container.layoutManager.eventHub.emit( 'redrawVisibleData', data );	
						container.layoutManager.eventHub.emit( 'datosvisibles', data );	
						container.layoutManager.eventHub.emit( 'datos', data );		   	
										   
					});
			})

			container.layoutManager.eventHub.on( 'redrawVisibleData', function( ret ){
				container.layoutManager.eventHub.on( 'datos', function( data ){
						data=ret

				var new_datos=[]
				var parse=[];
		    	var dateparse=[];
		   		var categoric=[];	
							
					document.getElementById('buttonComplete').innerHTML='<p></p><p></p><button type="button" id="complete_data_btn"> <strong>SHOW ('+data.length+' VALUES)</strong></button><p></p><p></p><p></p><p></p>'	
					$('button[id="complete_data_btn"]').click(function() {  	
											
						container.layoutManager.eventHub.emit( 'redrawVisibleData', data );	
						container.layoutManager.eventHub.emit( 'datosvisibles', data );	
						container.layoutManager.eventHub.emit( 'datos', data );		   	
										   
					});		

				container.layoutManager.eventHub.on( 'argis_attributes', function( arc ){
					var cols_esri = Object.keys(arc[0]);				
					
					arc.map(function(e){
						data.map(function(d){
							if(d.hasOwnProperty('Shape')){
								if(parseInt(e.FID) === parseInt(d.Shape.split('-')[1])){
									for(var i=0;i<cols_esri.length;i++){
										d[cols_esri[i]]=e[cols_esri[i]]
										new_datos.push(d)
									}
									new_datos=new_datos.filter((value, index, self) => self.indexOf(value) === index)


								}
							}
						})
					})	

					container.layoutManager.eventHub.emit('datachanged',new_datos)		

						



				function json2table(json, classes) {
					console.log(json)
					var cols = Object.keys(json[0]);
					console.log(cols)
					  
					var headerRow = '';
					var bodyRows = '';
					var columnas='';
					var columnasSeq='';
					var columnsSequential=[];
					var columns=[];
					  
					classes = classes || '';
					function capitalizeFirstLetter(string) {
						return string.charAt(0).toUpperCase() + string.slice(1);
					}
					  
					json.map(function(row) {
						bodyRows += '<tr>';
						cols.map(function(colName) {
						  bodyRows += '<td>' + row[colName] + '</td>';
						  columns.push(row[colName])
						  //console.log(cols.length)
						})
						bodyRows += '</tr>';
					});


					for (i = 0; i < cols.length; i++){
						if(/^[+-]?([0-9]*[.])?[0-9]+$/.test(columns[i]))
						{ 
						 parse.push(cols[i])
						}
						else if(/([0-9]{0,4})([0-9]{0,4})?(\/)([0-9]{0,4})([0-9]{0,4})?(\/)(\d{0,4})/.test(columns[i]))
						{
						  dateparse.push(cols[i])
						} 
						else if(/[GMT-]{4}[0-9]{4}/.test(columns[i]))
						{
						  dateparse.push(cols[i])
						}  
						else
						{
						  categoric.push(cols[i])
						}
					}
					if(parse.includes('Year') && categoric.includes('Year')){
						var value = 'Year'
						parse=parse.filter(function(item) { 
						return item !== value
					 })}
					var seq_new=parse.filter((value, index, self) => self.indexOf(value) === index);		
					
					for (var i=0;i<dateparse.length;i++){
						   seq_new.push(dateparse[i])      
					}

					console.log(seq_new)

					container.layoutManager.eventHub.emit( 'dateParseEvent', dateparse );
					var cat_new=categoric.filter((value, index, self) => self.indexOf(value) === index);
					container.layoutManager.eventHub.emit( 'categoricsEvent', cat_new );
					cols.map(function(col) {
					headerRow += '<th>' + capitalizeFirstLetter(col) + '</th>';
					columnas += '<option value="'+col+'">'
					});	
					
					seq_new.map(function(col) {	
									if (!(col=="Year" ||  col=="Day" || col=="DayNight" || col=="Minutes" || col=="Month" || col=="DayOfTheWeek" || col=="Latitude" || col=="Longitude" || col=="DayNight" || col=="Date" || col=="Hours" || col=="Seconds" || col=='__seqId'||col=='__id'||dateparse.includes(col))){
											if(!(cat_new).includes(col)){
												console.log(col)									
												columnsSequential.push('<option value="'+col+'">')	
											}
									}																											
							columnsSequential=columnsSequential.filter((value, index, self) => self.indexOf(value) === index)
							columnasSeq=columnsSequential.join('')	
					});					
						
					

					container.layoutManager.eventHub.emit( 'seqColumns', seq_new );
					container.layoutManager.eventHub.emit( 'catColumns', cat_new );
					
					//console.log(columnasSeq)
					container.layoutManager.eventHub.emit( 'columnas_list', columnas );
					container.layoutManager.eventHub.emit( 'columnasSeq_list', columnasSeq );


					return '<table id="data" class="display nowrap" style="width:100%">'+'<thead><tr>' +
						 headerRow +
						 '</tr></thead><tbody>' +
						 bodyRows +
						 '</tbody></table>';
				}	



				document.getElementById('tableGoesHere').innerHTML = json2table(new_datos, 'table');
				
					$(document).ready(function() {
						$('#data').DataTable( {  
							"scrollY": 300,
							"scrollX": true
						});
					});

					function loadScript(src) {
					       var script = document.createElement("script");
					       script.type = "text/javascript";
					       document.getElementById("tableGoesHere").appendChild(script);
					       script.src = src;		      
					}
					function loadStyle(src) {
					       var script = document.createElement("link");
					       script.rel = 'stylesheet'
					       script.type = "text/css";
					       document.getElementById("tableGoesHere").appendChild(script);
					       script.href = src;
					}
					$(document).ready(function() {
						$('#data').DataTable( {
							destroy: true,
						    dom: 'lBfrtip',
						    buttons: [
						        'copy', 'csv', 'excel', 'pdf', 'print'
						    ],
						    "scrollY": 300,
				    		"scrollX": true
						});
					});		

					loadStyle('https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css')
					loadStyle('https://cdn.datatables.net/buttons/1.5.2/css/buttons.dataTables.min.css')
					loadScript('https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js')
					loadScript('https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js')
					loadScript('https://cdn.datatables.net/buttons/1.5.2/js/buttons.flash.min.js')
					loadScript('https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js')
					loadScript('https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js')
					loadScript('https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js')
					loadScript('https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js')
					loadScript('https://cdn.datatables.net/buttons/1.5.2/js/buttons.print.min.js')				

					var script = document.createElement("script");
					script.text="var table; $(document).ready(function() {$('#visible').DataTable( {destroy: true,paging: true, searching: true, dom: 'lBfrtip', buttons: ['copy', 'csv', 'excel', 'pdf', 'print']} );} );"
					document.getElementById("tableGoesHere").appendChild(script);
					
				})
				})	
		    })	
				
	}])
	navioApp.controller('navioController', ["$scope",'$timeout',"container","state","TestService",function( $scope,$timeout,container, state,TestService ) { 
		
		console.log("entro aca")	
		container.layoutManager.eventHub.on( 'datos', function( data ){
				container.layoutManager.eventHub.on( 'seqColumns', function( seqColumns ){
					container.layoutManager.eventHub.on( 'catColumns', function( catColumns ){
						nv=navio(d3.select("#navio"), 600);
							catColumns.forEach((c) => nv.addCategoricalAttrib(c));
							seqColumns.forEach((c) => nv.addSequentialAttrib(c));
							
							nv.data(data);
							visible = nv.getVisible();						
							
							container.layoutManager.eventHub.emit( 'datosvisibles', visible );	
							container.layoutManager.eventHub.emit( 'redrawVisibleData', data );							
							console.log(data)
							nv.updateCallback(function(){
								visible = nv.getVisible();
								container.layoutManager.eventHub.emit( 'datosvisibles', visible );								
								container.layoutManager.eventHub.emit( 'redrawVisibleData', visible );
								console.log(seqColumns)
								container.layoutManager.eventHub.emit( 'seqColumns', seqColumns );
								console.log(catColumns)
								
							container.layoutManager.eventHub.emit( 'datos', data );
								console.log(catColumns)
								console.log(visible)
								container.layoutManager.eventHub.on( 'change-attr1', function( attr1 ){
									console.log(attr1)
									container.layoutManager.eventHub.on( 'change-attr2', function( attr2 ){
										console.log(attr2)
										container.layoutManager.eventHub.on( 'vis', function( vis ){
											vis(attr1,attr2,seqColumns,catColumns,visible)
										})
									})
								})
							})	
				});
			});
		});	

		container.layoutManager.eventHub.on( 'datachanged', function( data ){
				container.layoutManager.eventHub.on( 'seqColumns', function( seqColumns ){
					container.layoutManager.eventHub.on( 'catColumns', function( catColumns ){
						nv=navio(d3.select("#navio"), 600);
							catColumns.forEach((c) => nv.addCategoricalAttrib(c));
							seqColumns.forEach((c) => nv.addSequentialAttrib(c));
							
							nv.data(data);
							visible = nv.getVisible();						
							
							container.layoutManager.eventHub.emit( 'datosvisibles', visible );	
							container.layoutManager.eventHub.emit( 'redrawVisibleData', visible );	
							container.layoutManager.eventHub.emit( 'datachanged', visible );
							

							console.log(data)
							nv.updateCallback(function(){
								visible = nv.getVisible();
								container.layoutManager.eventHub.emit( 'datosvisibles', visible );								
								container.layoutManager.eventHub.emit( 'datachanged', visible );
								container.layoutManager.eventHub.emit( 'redrawVisibleData', visible );
								container.layoutManager.eventHub.emit( 'seqColumns', seqColumns );
							container.layoutManager.eventHub.emit( 'datos', data );


								console.log(visible)
								container.layoutManager.eventHub.on( 'change-attr1', function( attr1 ){
									console.log(attr1)
									container.layoutManager.eventHub.on( 'change-attr2', function( attr2 ){
										console.log(attr2)
										container.layoutManager.eventHub.on( 'vis', function( vis ){
											vis(attr1,attr2,seqColumns,catColumns,visible)
										})
									})
								})
							})	
				});
			});
		});
	}])
	spatioApp.controller('spatioController', ["$scope",'$timeout',"container","state","TestService",function( $scope,$timeout,container, state,TestService ) { 	
		
		container.layoutManager.eventHub.on( 'columnas_list', function( cols ){		
				console.log(cols)
				container.layoutManager.eventHub.on( 'datos', function( completedata ){		
					console.log(completedata)	
					container.layoutManager.eventHub.on( 'seqColumns', function( seqColumns ){
						console.log(seqColumns)
						container.layoutManager.eventHub.on( 'redrawVisibleData', function( datos ){
							console.log(datos)
						container.layoutManager.eventHub.on( 'catColumns', function( catColumns ){
							console.log(catColumns)
							
								if(datos[0].hasOwnProperty('Latitude') && datos[0].hasOwnProperty('Longitude')){
									document.getElementById("text").innerHTML='<p><strong>Select two attributes from this dataset that you would like to analize graphically:</strong></p>'
									document.getElementById("list").innerHTML = '<strong>Attribute 1:</strong><input list="attrs1" type="text" id="attr1"><datalist id="attrs1">'+cols
									document.getElementById("list2").innerHTML = '<strong>Attribute 2:</strong> <input list="attrs2" type="text" id="attr2"><datalist id="attrs2">'+cols
									document.getElementById("btn1").innerHTML='<button type="button" id="complete_t"> <strong>SHOW COMPLETE VALUES</strong></button>'
									$('button[id="complete_t"]').click(function() {								    	
										
										container.layoutManager.eventHub.emit( 'redrawVisibleData', completedata );	
										container.layoutManager.eventHub.emit( 'datosvisibles', completedata );			   	
									   
									});
									function drawViz(seqColumns,catColumns,attr1,attr2,visible)
									{
										if(datos[0].hasOwnProperty('Year')){
											if(seqColumns.includes(attr1) && seqColumns.includes(attr2) && (attr1!='Date' && attr2!='Date')){
											var yourVlSpec = {
												"width": 1000,
												"height": 300,
												"autosize": {"type": "fit", "contains": "padding"},
												"data": {"values":visible},
												"transform": [{"calculate": "year(datum.Year)", "as": "Year"},{"filter": {"selection": "brush"}}],
												"selection": {
												"grid": {
												"type": "interval", "bind": "scales"
											},
												"CylYr": {
												"type": "single",
												"fields": ["Year"],
												"bind": {
												"Year": {"input": "range", "min": d3.min(visible,d=>+d.Year-1).toString(), "max":d3.max(visible,d=>+d.Year-1).toString(), "step": 1}
											},
												"on": "click",
												"resolve": "global",
												"empty": "all"
											}
											},
												"mark": "circle",
												"encoding": {
												"x": {"field": attr1, "type": "quantitative","scale": {"domain": [d3.min(visible,d => +d[attr1]), d3.max(visible,d => +d[attr1])]}},
												"y": {"field": attr2, "type": "quantitative","scale": {"domain": [d3.min(visible,d => +d[attr2]), d3.max(visible,d => +d[attr2])]}},
												"color": {
												"condition": {"selection": "CylYr", "field": "Year", "type": "nominal"},
												"value": "#D8D8D8"
												},
												"size": {
													"condition": {
													  "selection": "CylYr",
													  "value": 100,
													  "fill":'None'
													}
												}
											}
											}
											container.layoutManager.eventHub.emit( 'yourVlSpec', yourVlSpec );	
											spatial(yourVlSpec,visible)
											}
											else if(catColumns.includes(attr1) && catColumns.includes(attr2)){
											setTimeout(function(){
												alert("You selected TWO categorical attributes.\nSelect a variable combination, as follows:\nCATEGORICAL/SEQUENTIAL or SEQUENTIAL/SEQUENTIAL")
											},200)
											}							
											else if(catColumns.includes(attr1) && seqColumns.includes(attr2)){
											var yourVlSpec = {
											  "width": 1000,
											  "height": 300,
											  "autosize": {"type": "fit", "contains": "padding"},
											  "data": {"values":visible},
											  "transform": [{"calculate": "year(datum.Year)", "as": "Year"},{"filter": {"selection": "brush"}}],
											  "selection": {
											  "grid": {
											  "type": "interval", "bind": "scales"
											  },
											  "CylYr": {
											  "type": "single",
											  "fields": ["Year"],
											  "bind": {
											  "Year": {"input": "range", "min": d3.min(visible,d=>+d.Year-1).toString(), "max":d3.max(visible,d=>+d.Year-1).toString(), "step": 1}
											  },
											  "on": "click",
											  "resolve": "global",
											  "empty": "all"
											  }
											  },
											  "mark": "bar",
											  "encoding": {
											  "x": {"field": attr1, "type": "ordinal"},
											  "y": {"field": attr2, "type": "quantitative","scale": {"domain": [d3.min(visible,d => +d[attr2]), d3.max(visible,d => +d[attr2])]}},
											  "color": {
											  "condition": {"selection": "CylYr", "field": "Year", "type": "nominal"},
											  "value": "#D8D8D8"
											  },
											  "size": {
											      "condition": {
											          "selection": "CylYr",
											          "value": 100,
											          "fill":'None'
											      	}
											  	}
											 }
											}
											container.layoutManager.eventHub.emit( 'yourVlSpec', yourVlSpec );
											spatial(yourVlSpec,visible)
											}
											else if(seqColumns.includes(attr1) && catColumns.includes(attr2)){
											var yourVlSpec = {
											  "width": 1000,
											  "height": 300,
											  "autosize": {"type": "fit", "contains": "padding"},
											  "data": {"values":visible},
											  "transform": [{"calculate": "year(datum.Year)", "as": "Year"},{"filter": {"selection": "brush"}}],
											  "selection": {
											  "grid": {
											  "type": "interval", "bind": "scales"
											  },
											  "CylYr": {
											  "type": "single",
											  "fields": ["Year"],
											  "bind": {
											  "Year": {"input": "range", "min": d3.min(visible,d=>+d.Year-1).toString(), "max":d3.max(visible,d=>+d.Year-1).toString(), "step": 1}
											  },
											  "on": "click",
											  "resolve": "global",
											  "empty": "all"
											  }
											  },
											  "mark": "bar",
											  "encoding": {
											  "x": {"field": attr2, "type": "ordinal"},
											  "y": {"field": attr1, "type": "quantitative","scale": {"domain": [d3.min(visible,d => +d[attr1]), d3.max(visible,d => +d[attr1])]}},
											  "color": {
											  "condition": {"selection": "CylYr", "field": "Year", "type": "nominal"},
											  "value": "#D8D8D8"
											  },
											  "size": {
											      "condition": {
											          "selection": "CylYr",
											          "value": 100,
											          "fill":'None'
											      }
											  }
											 }
											}
											container.layoutManager.eventHub.emit( 'yourVlSpec', yourVlSpec );
											spatial(yourVlSpec,visible)
											}
											else if(seqColumns.includes(attr1) && seqColumns.includes(attr2) && (attr1=='Date')){
											console.log("ENTR AC")
											var yourVlSpec = {
											  "width": 1000,
											  "height": 300,
											  "autosize": {"type": "fit", "contains": "padding"},
											  "data": {"values":visible},
											  "transform": [{"calculate": "year(datum.Year)", "as": "Year"},{"filter": {"selection": "brush"}}],
											  "selection": {
											  "grid": {
											  "type": "interval", "bind": "scales"
											  }},
											  "mark": {"type":"point"},
											  "encoding": {
											  "x": {"field": attr1, "type": "temporal"},
											  "y": {"field": attr2, "type": "quantitative","scale": {"domain": [d3.min(visible,d => +d[attr2]), d3.max(visible,d => +d[attr2])]}}
											}
											}
											container.layoutManager.eventHub.emit( 'yourVlSpec', yourVlSpec );
											spatial(yourVlSpec,visible)
											}
											else if(seqColumns.includes(attr1) && seqColumns.includes(attr2) && (attr2=='Date')){
											var yourVlSpec = {
											  "width": 1000,
											  "height": 300,
											  "autosize": {"type": "fit", "contains": "padding"},
											  "data": {"values":visible},
											  "transform": [{"calculate": "year(datum.Year)", "as": "Year"},{"filter": {"selection": "brush"}}],
											  "selection": {
											  "grid": {
											  "type": "interval", "bind": "scales"
											  }},
											  "mark": {"type":"point"},
											  "encoding": {
											  "x": {"field": attr2, "type": "temporal"},
											  "y": {"field": attr1, "type": "quantitative","scale": {"domain": [d3.min(visible,d => +d[attr1]), d3.max(visible,d => +d[attr1])]}}
											}
											}
											container.layoutManager.eventHub.emit( 'yourVlSpec', yourVlSpec );
											spatial(yourVlSpec,visible)
											}
										}
										else{
											if(seqColumns.includes(attr1) && seqColumns.includes(attr2) && (attr1!='Date' && attr2!='Date')){
											var yourVlSpec = {
												"width": 1000,
												"height": 300,
												"autosize": {"type": "fit", "contains": "padding"},
												"data": {"values":visible},
												"transform": [{"filter": {"selection": "brush"}}],
												"selection": {
												"grid": {
												"type": "interval", "bind": "scales"
											}},
												"mark": "circle",
												"encoding": {
												"x": {"field": attr1, "type": "quantitative","scale": {"domain": [d3.min(visible,d => +d[attr1]), d3.max(visible,d => +d[attr1])]}},
												"y": {"field": attr2, "type": "quantitative","scale": {"domain": [d3.min(visible,d => +d[attr2]), d3.max(visible,d => +d[attr2])]}}
											}
											}
											container.layoutManager.eventHub.emit( 'yourVlSpec', yourVlSpec );	
											spatial(yourVlSpec,visible)
											}
											else if(catColumns.includes(attr1) && catColumns.includes(attr2)){
											setTimeout(function(){
												alert("You selected TWO categorical attributes.\nSelect a variable combination, as follows:\nCATEGORICAL/SEQUENTIAL or SEQUENTIAL/SEQUENTIAL")
											},200)
											}							
											else if(catColumns.includes(attr1) && seqColumns.includes(attr2)){
											var yourVlSpec = {
											  "width": 1000,
											  "height": 300,
											  "autosize": {"type": "fit", "contains": "padding"},
											  "data": {"values":visible},
											  "transform": [{"filter": {"selection": "brush"}}],
											  "selection": {
											  "grid": {
											  "type": "interval", "bind": "scales"
											  }},
											  "mark": "bar",
											  "encoding": {
											  "x": {"field": attr1, "type": "ordinal"},
											  "y": {"field": attr2, "type": "quantitative","scale": {"domain": [d3.min(visible,d => +d[attr2]), d3.max(visible,d => +d[attr2])]}}							  
											 }
											}
											container.layoutManager.eventHub.emit( 'yourVlSpec', yourVlSpec );
											spatial(yourVlSpec,visible)
											}
											else if(seqColumns.includes(attr1) && catColumns.includes(attr2)){
											var yourVlSpec = {
											  "width": 1000,
											  "height": 300,
											  "autosize": {"type": "fit", "contains": "padding"},
											  "data": {"values":visible},
											  "transform": [{"filter": {"selection": "brush"}}],
											  "selection": {
											  "grid": {
											  "type": "interval", "bind": "scales"
											  }},
											  "mark": "bar",
											  "encoding": {
											  "x": {"field": attr2, "type": "ordinal"},
											  "y": {"field": attr1, "type": "quantitative","scale": {"domain": [d3.min(visible,d => +d[attr1]), d3.max(visible,d => +d[attr1])]}}								  
											 }
											}
											container.layoutManager.eventHub.emit( 'yourVlSpec', yourVlSpec );
											spatial(yourVlSpec,visible)
											}
											else if(seqColumns.includes(attr1) && seqColumns.includes(attr2) && (attr1=='Date')){
											console.log("ENTR AC")
											var yourVlSpec = {
											  "width": 1000,
											  "height": 300,
											  "autosize": {"type": "fit", "contains": "padding"},
											  "data": {"values":visible},
											  "transform": [{"filter": {"selection": "brush"}}],
											  "selection": {
											  "grid": {
											  "type": "interval", "bind": "scales"
											  }},
											  "mark": {"type":"point"},
											  "encoding": {
											  "x": {"field": attr1, "type": "temporal"},
											  "y": {"field": attr2, "type": "quantitative","scale": {"domain": [d3.min(visible,d => +d[attr2]), d3.max(visible,d => +d[attr2])]}}
											}
											}
											container.layoutManager.eventHub.emit( 'yourVlSpec', yourVlSpec );
											spatial(yourVlSpec,visible)
											}
											else if(seqColumns.includes(attr1) && seqColumns.includes(attr2) && (attr2=='Date')){
											var yourVlSpec = {
											  "width": 1000,
											  "height": 300,
											  "autosize": {"type": "fit", "contains": "padding"},
											  "data": {"values":visible},
											  "transform": [{"filter": {"selection": "brush"}}],
											  "selection": {
											  "grid": {
											  "type": "interval", "bind": "scales"
											  }},
											  "mark": {"type":"point"},
											  "encoding": {
											  "x": {"field": attr2, "type": "temporal"},
											  "y": {"field": attr1, "type": "quantitative","scale": {"domain": [d3.min(visible,d => +d[attr1]), d3.max(visible,d => +d[attr1])]}}
											}
											}
											container.layoutManager.eventHub.emit( 'yourVlSpec', yourVlSpec );
											spatial(yourVlSpec,visible)
											}
										}
									}
									var spatial=function(yourVlSpec,visible)
									{
											var spatialvis = {
											            "width": 1000,
											            "height": 300,
											            "data": {"values":visible},
											            "transform": [{"filter": {"selection": "brush"}}],
											            "vconcat": [{
											              "selection": {
											                "brush": {
											                  "type": "interval",
											                  "on": "[mousedown, window:mouseup] > window:mousemove!",
											                  "encodings": ["x", "y"],
											                  "translate": "[mousedown, window:mouseup] > window:mousemove!",
											                  "zoom": "wheel!",
											                  "mark": {"fill": "#333", "stroke": "green"},
											                  "resolve": "global"
											                  }
											              },
											              "width": 700,
											              "mark": "point",
											              "encoding": {
											                "x": {"field": "Longitude","type": "quantitative","scale": {"domain": [d3.min(visible,d => +d.Longitude), d3.max(visible,d => +d.Longitude)]}},
											                "y": {"field": "Latitude","type": "quantitative","scale": {"domain": [d3.min(visible,d => +d.Latitude), d3.max(visible,d => +d.Latitude)]}}
											              }
											            }, yourVlSpec]
											          }									
											vegaEmbed("#spatial", spatialvis);
									}
									var vis = function(attr1,attr2,seqColumns,catColumns,visible){
										
										d3.select("#attr1").on("change", function(){
											attr1 = this.value;
											container.layoutManager.eventHub.emit( 'change-attr1', attr1 );	
										  	//console.log(attr1)
											drawViz(seqColumns,catColumns,attr1,attr2,visible)	
											
										})
										d3.select("#attr2").on("change", function(){
										  	attr2 = this.value;
										  	container.layoutManager.eventHub.emit( 'change-attr2', attr2 );		
										  	//console.log(attr2)
										  	drawViz(seqColumns,catColumns,attr1,attr2,visible)
										})				
									}
									container.layoutManager.eventHub.emit( 'vis', vis(attr1,attr2,seqColumns,catColumns,datos) );
								}		
								else{
									document.getElementById("text").innerHTML='<p><strong><font size="3">THERE ARE NOT SPATIAL ATTRIBUTES THAT PERMITS ANY SPATIAL ANALYSIS</font></strong></p>'
								}					
							})
						})
					})
				})	
			})
	}])
	temporalApp.controller('temporalController', ["$scope",'$timeout',"container","state","TestService",function( $scope,$timeout,container, state,TestService ) { 
		container.layoutManager.eventHub.on( 'columnasSeq_list', function( cols ){
			container.layoutManager.eventHub.on( 'redrawVisibleData', function( completedata ){
			
				console.log(cols)
						//document.getElementById("list3").innerHTML = '<strong>Select a Quantitative Value: </strong> <input list="attrs3" type="text" id="attr3"><datalist id="attrs3">'+cols
						var year=[]
						var daynight=[]
						var dayofMonth=[]
						var day=[]
						var month=[]
						var hour=[]
						var weekmonth=[]
						var isWeekDay=[]
						var year_t=''
						var daynight_t=''
						var dayofMonth_t=''
						var day_t=''
						var month_t=''
						var hour_t=''
						var weekmonth_t=''
						var isWeekDay_t=''

						
						if(completedata[0].hasOwnProperty("Year")){
							completedata.map(function(d){
								year.push(d['Year'])
								daynight.push(d['DayNight'])
								day.push(d['DayOfTheWeek'])
								dayofMonth.push(d['Day'])
								month.push(d['Month'])
								hour.push(d['Hours'])
								weekmonth.push(d['WeekOfTheMonth'])
								isWeekDay.push(d['isWeekDay'])
							})
							function sortNumber(a,b) {
						        return a - b;
						    }
							year=year.filter((value, index, self) => self.indexOf(value) === index).sort(sortNumber)
							daynight=daynight.filter((value, index, self) => self.indexOf(value) === index).sort()
							day=day.filter((value, index, self) => self.indexOf(value) === index).sort().sort(sortNumber)
							dayofMonth=dayofMonth.filter((value, index, self) => self.indexOf(value) === index).sort()
							month=month.filter((value, index, self) => self.indexOf(value) === index)
							hour=hour.filter((value, index, self) => self.indexOf(value) === index).sort(sortNumber)
							weekmonth=weekmonth.filter((value, index, self) => self.indexOf(value) === index).sort()
							isWeekDay=isWeekDay.filter((value, index, self) => self.indexOf(value) === index)
							var complete_enable='<button type="button" id="complete"> Show ('+completedata.length+' values)</button>'

							setTimeout(function(){
									//year_t=' <label class="switch"> <input type="checkbox" id="checkbox1">      <div class="slider round">         <span class="on">ON</span>           <span class="off">OFF</span>           </div>         </label>'
									for(var i=0;i<year.length;i++){	

										if(!(i % 4 === 0)){
											console.log("entro")
											year_t+='<label class="switch"> <input type="checkbox" value="'+year[i]+'" id="year"><div class="slider round">         <span class="on">'+year[i]+'</span>           <span class="off">'+year[i]+'</span>           </div>         </label>'
										}
										else{
											year_t+='<p></p><label class="switch"> <input type="checkbox" value="'+year[i]+'" id="year"><div class="slider round">         <span class="on">'+year[i]+'</span>           <span class="off">'+year[i]+'</span>           </div>         </label>'
										}						
									}
									for(var i=0;i<daynight.length;i++){	

										if(!(i % 4 === 0)){
											console.log("entro")
											if(daynight[i]=='diurnal'){
												daynight_t+='<label class="switch"> <input type="checkbox" value="'+daynight[i]+'" id="daynight"><div class="slider round">         <span class="on">DAY</span>           <span class="off">DAY</span>           </div>         </label>'
											}
											if(daynight[i]=='night'){
												daynight_t+='<label class="switch"> <input type="checkbox" value="'+daynight[i]+'" id="daynight"><div class="slider round">         <span class="on">NIGHT</span>           <span class="off">NIGHT</span>           </div>         </label>'
											}
										}
										else{
											if(daynight[i]=='diurnal'){
												daynight_t+='<p></p><label class="switch"> <input type="checkbox" value="'+daynight[i]+'" id="daynight"><div class="slider round">         <span class="on">DAY</span>           <span class="off">DAY</span>           </div>         </label>'
											}
											if(daynight[i]=='night'){
												daynight_t+='<p></p><label class="switch"> <input type="checkbox" value="'+daynight[i]+'" id="daynight"><div class="slider round">         <span class="on">NIGHT</span>           <span class="off">NIGHT</span>           </div>         </label>'
											}
										}						
									}
									for(var i=0;i<day.length;i++){	

										if(!(i % 4 === 0)){
											console.log("entro")
											if(day[i]=='Monday'){
													day_t+='<label class="switch"> <input type="checkbox" value="'+day[i]+'" id="day"><div class="slider round">         <span class="on">MON</span>           <span class="off">MON</span>           </div>         </label>'
											}
											if(day[i]=='Tuesday'){
													day_t+='<label class="switch"> <input type="checkbox" value="'+day[i]+'" id="day"><div class="slider round">         <span class="on">TUE</span>           <span class="off">TUE</span>           </div>         </label>'
											}
											if(day[i]=='Wednesday'){
													day_t+='<label class="switch"> <input type="checkbox" value="'+day[i]+'" id="day"><div class="slider round">         <span class="on">WED</span>           <span class="off">WED</span>           </div>         </label>'
											}
											if(day[i]=='Thursday'){
													day_t+='<label class="switch"> <input type="checkbox" value="'+day[i]+'" id="day"><div class="slider round">         <span class="on">THU</span>           <span class="off">THU</span>           </div>         </label>'
											}
											if(day[i]=='Friday'){
													day_t+='<label class="switch"> <input type="checkbox" value="'+day[i]+'" id="day"><div class="slider round">         <span class="on">FRI</span>           <span class="off">FRI</span>           </div>         </label>'
											}
											if(day[i]=='Saturday'){
													day_t+='<label class="switch"> <input type="checkbox" value="'+day[i]+'" id="day"><div class="slider round">         <span class="on">SAT</span>           <span class="off">SAT</span>           </div>         </label>'
											}
											if(day[i]=='Sunday'){
													day_t+='<label class="switch"> <input type="checkbox" value="'+day[i]+'" id="day"><div class="slider round">         <span class="on">SUN</span>           <span class="off">SUN</span>           </div>         </label>'
											}
										}
										else{

											if(day[i]=='Monday'){
													day_t+='<p></p><label class="switch"> <input type="checkbox" value="'+day[i]+'" id="day"><div class="slider round">         <span class="on">MON</span>           <span class="off">MON</span>           </div>         </label>'
											}
											if(day[i]=='Tuesday'){
													day_t+='<p></p><label class="switch"> <input type="checkbox" value="'+day[i]+'" id="day"><div class="slider round">         <span class="on">TUE</span>           <span class="off">TUE</span>           </div>         </label>'
											}
											if(day[i]=='Wednesday'){
													day_t+='<p></p><label class="switch"> <input type="checkbox" value="'+day[i]+'" id="day"><div class="slider round">         <span class="on">WED</span>           <span class="off">WED</span>           </div>         </label>'
											}
											if(day[i]=='Thursday'){
													day_t+='<p></p><label class="switch"> <input type="checkbox" value="'+day[i]+'" id="day"><div class="slider round">         <span class="on">THU</span>           <span class="off">THU</span>           </div>         </label>'
											}
											if(day[i]=='Friday'){
													day_t+='<p></p><label class="switch"> <input type="checkbox" value="'+day[i]+'" id="day"><div class="slider round">         <span class="on">FRI</span>           <span class="off">FRI</span>           </div>         </label>'
											}
											if(day[i]=='Saturday'){
													day_t+='<p></p><label class="switch"> <input type="checkbox" value="'+day[i]+'" id="day"><div class="slider round">         <span class="on">SAT</span>           <span class="off">SAT</span>           </div>         </label>'
											}
											if(day[i]=='Sunday'){
													day_t+='<p></p><label class="switch"> <input type="checkbox" value="'+day[i]+'" id="day"><div class="slider round">         <span class="on">SUN</span>           <span class="off">SUN</span>           </div>         </label>'
											}											
										}						
									}
									for(var i=0;i<dayofMonth.length;i++){	

										if(!(i % 4 === 0)){
											console.log("entro")
											dayofMonth_t+='<label class="switch"> <input type="checkbox" value="'+dayofMonth[i]+'" id="dayofMonth"><div class="slider round">         <span class="on">'+dayofMonth[i]+'</span>           <span class="off">'+dayofMonth[i]+'</span>           </div>         </label>'
										}
										else{
											dayofMonth_t+='<p></p><label class="switch"> <input type="checkbox" value="'+dayofMonth[i]+'" id="dayofMonth"><div class="slider round">         <span class="on">'+dayofMonth[i]+'</span>           <span class="off">'+dayofMonth[i]+'</span>           </div>         </label>'
										}						
									}
									for(var i=0;i<month.length;i++){	

										if(!(i % 4 === 0)){
											console.log("entro")
											if(month[i]=='January'){
													month_t+='<label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">JAN</span>           <span class="off">JAN</span>           </div>         </label>'
											}
											if(month[i]=='February'){
													month_t+='<label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">FEB</span>           <span class="off">FEB</span>           </div>         </label>'
											}
											if(month[i]=='March'){
													month_t+='<label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">MAR</span>           <span class="off">MAR</span>           </div>         </label>'
											}
											if(month[i]=='April'){
													month_t+='<label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">APR</span>           <span class="off">APR</span>           </div>         </label>'
											}
											if(month[i]=='May'){
													month_t+='<label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">MAY</span>           <span class="off">MAY</span>           </div>         </label>'
											}
											if(month[i]=='June'){
													month_t+='<label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">JUN</span>           <span class="off">JUN</span>           </div>         </label>'
											}
											if(month[i]=='July'){
													month_t+='<label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">JUL</span>           <span class="off">JUL</span>           </div>         </label>'
											}
											if(month[i]=='August'){
													month_t+='<label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">AUG</span>           <span class="off">AUG</span>           </div>         </label>'
											}
											if(month[i]=='September'){
													month_t+='<label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">SEPT</span>           <span class="off">SEPT</span>           </div>         </label>'
											}
											if(month[i]=='October'){
													month_t+='<label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">OCT</span>           <span class="off">OCT</span>           </div>         </label>'
											}
											if(month[i]=='November'){
													month_t+='<label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">NOV</span>           <span class="off">NOV</span>           </div>         </label>'
											}
											if(month[i]=='December'){
													month_t+='<label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">DEC</span>           <span class="off">DEC</span>           </div>         </label>'
											}
										}
										else{
											if(month[i]=='January'){
													month_t+='<p></p><label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">JAN</span>           <span class="off">JAN</span>           </div>         </label>'
											}
											if(month[i]=='February'){
													month_t+='<p></p><label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">FEB</span>           <span class="off">FEB</span>           </div>         </label>'
											}
											if(month[i]=='March'){
													month_t+='<p></p><label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">MAR</span>           <span class="off">MAR</span>           </div>         </label>'
											}
											if(month[i]=='April'){
													month_t+='<p></p><label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">APR</span>           <span class="off">APR</span>           </div>         </label>'
											}
											if(month[i]=='May'){
													month_t+='<p></p><label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">MAY</span>           <span class="off">MAY</span>           </div>         </label>'
											}
											if(month[i]=='June'){
													month_t+='<p></p><label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">JUN</span>           <span class="off">JUN</span>           </div>         </label>'
											}
											if(month[i]=='July'){
													month_t+='<p></p><label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">JUL</span>           <span class="off">JUL</span>           </div>         </label>'
											}
											if(month[i]=='August'){
													month_t+='<p></p><label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">AUG</span>           <span class="off">AUG</span>           </div>         </label>'
											}
											if(month[i]=='September'){
													month_t+='<p></p><label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">SEPT</span>           <span class="off">SEPT</span>           </div>         </label>'
											}
											if(month[i]=='October'){
													month_t+='<p></p><label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">OCT</span>           <span class="off">OCT</span>           </div>         </label>'
											}
											if(month[i]=='November'){
													month_t+='<p></p><label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">NOV</span>           <span class="off">NOV</span>           </div>         </label>'
											}
											if(month[i]=='December'){
													month_t+='<p></p><label class="switch"> <input type="checkbox" value="'+month[i]+'" id="month"><div class="slider round">         <span class="on">DEC</span>           <span class="off">DEC</span>           </div>         </label>'
											}
										}						
									}
									for(var i=0;i<hour.length;i++){	

										if(!(i % 4 === 0)){
											console.log("entro")
											hour_t+='<label class="switch"> <input type="checkbox" value="'+hour[i]+'" id="hour"><div class="slider round">         <span class="on">'+hour[i]+'-hr</span>           <span class="off">'+hour[i]+'-hr</span>           </div>         </label>'
										}
										else{
											hour_t+='<p></p><label class="switch"> <input type="checkbox" value="'+hour[i]+'" id="hour"><div class="slider round">         <span class="on">'+hour[i]+'-hr</span>           <span class="off">'+hour[i]+'-hr</span>           </div>         </label>'
										}						
									}
									for(var i=0;i<weekmonth.length;i++){	


										if(!(i % 4 === 0)){
											if(weekmonth[i]=='First'){
													console.log("entro")
													weekmonth_t+='<label class="switch"> <input type="checkbox" value="'+weekmonth[i]+'" id="weekmonth"><div class="slider round">         <span class="on">1st</span>           <span class="off">1st</span>           </div>         </label>'
											}
											if(weekmonth[i]=='Second'){
													console.log("entro")
													weekmonth_t+='<label class="switch"> <input type="checkbox" value="'+weekmonth[i]+'" id="weekmonth"><div class="slider round">         <span class="on">2nd</span>           <span class="off">2nd</span>           </div>         </label>'
											}
											if(weekmonth[i]=='Third'){
													console.log("entro")
													weekmonth_t+='<label class="switch"> <input type="checkbox" value="'+weekmonth[i]+'" id="weekmonth"><div class="slider round">         <span class="on">3rd</span>           <span class="off">3rd</span>           </div>         </label>'
											}
											if(weekmonth[i]=='Fourth'){
													console.log("entro")
													weekmonth_t+='<label class="switch"> <input type="checkbox" value="'+weekmonth[i]+'" id="weekmonth"><div class="slider round">         <span class="on">4th</span>           <span class="off">4th</span>           </div>         </label>'
											}
											if(weekmonth[i]=='Fifth'){
													console.log("entro")
													weekmonth_t+='<label class="switch"> <input type="checkbox" value="'+weekmonth[i]+'" id="weekmonth"><div class="slider round">         <span class="on">5th</span>           <span class="off">5th</span>           </div>         </label>'
											}											
										}
										else{
											if(weekmonth[i]=='First'){
													console.log("entro")
													weekmonth_t+='<p></p><label class="switch"> <input type="checkbox" value="'+weekmonth[i]+'" id="weekmonth"><div class="slider round">         <span class="on">1st</span>           <span class="off">1st</span>           </div>         </label>'
											}
											if(weekmonth[i]=='Second'){
													console.log("entro")
													weekmonth_t+='<p></p><label class="switch"> <input type="checkbox" value="'+weekmonth[i]+'" id="weekmonth"><div class="slider round">         <span class="on">2nd</span>           <span class="off">2nd</span>           </div>         </label>'
											}
											if(weekmonth[i]=='Third'){
													console.log("entro")
													weekmonth_t+='<p></p><label class="switch"> <input type="checkbox" value="'+weekmonth[i]+'" id="weekmonth"><div class="slider round">         <span class="on">3rd</span>           <span class="off">3rd</span>           </div>         </label>'
											}
											if(weekmonth[i]=='Fourth'){
													console.log("entro")
													weekmonth_t+='<p></p><label class="switch"> <input type="checkbox" value="'+weekmonth[i]+'" id="weekmonth"><div class="slider round">         <span class="on">4th</span>           <span class="off">4th</span>           </div>         </label>'
											}
											if(weekmonth[i]=='Fifth'){
													console.log("entro")
													weekmonth_t+='<p></p><label class="switch"> <input type="checkbox" value="'+weekmonth[i]+'" id="weekmonth"><div class="slider round">         <span class="on">5th</span>           <span class="off">5th</span>           </div>         </label>'
											}
										}						
									}
									for(var i=0;i<isWeekDay.length;i++){	

										if(!(i % 4 === 0)){
											console.log("entro")
											isWeekDay_t+='<label class="switch"> <input type="checkbox" name="'+isWeekDay[i]+'" id="isWeekDay"><div class="slider round">         <span class="on">'+isWeekDay[i]+'</span>           <span class="off">'+isWeekDay[i]+'</span>           </div>         </label>'

  

										}
										else{
											isWeekDay_t+='<p></p><label class="switch"> <input type="checkbox" name="'+isWeekDay[i]+'" id="isWeekDay"><div class="slider round">         <span class="on">'+isWeekDay[i]+'</span>           <span class="off">'+isWeekDay[i]+'</span>           </div>         </label>'
										}						
									}

									year_t=('<ul>').concat(year_t)
									daynight_t=('<ul>').concat(daynight_t)
									dayofMonth_t=('<ul>').concat(dayofMonth_t)
									day_t=('<ul>').concat(day_t)
									month_t=('<ul>').concat(month_t)
									hour_t=('<ul>').concat(hour_t)
									weekmonth_t=('<ul>').concat(weekmonth_t)
									isWeekDay_t=('<ul>').concat(isWeekDay_t)
									year_t=year_t.concat('</ul>')
									daynight_t=daynight_t.concat('</ul>')
									dayofMonth_t=dayofMonth_t.concat('</ul>')
									day_t=day_t.concat('</ul>')
									month_t=month_t.concat('</ul>')
									hour_t=hour_t.concat('</ul>')
									weekmonth_t=weekmonth_t.concat('</ul>')
									isWeekDay_t=isWeekDay_t.concat('</ul>')

									var texto='';
									if(!(year_t.includes(undefined))){
										texto+=	'<p><font size="5"><strong>Year:</strong></font></p> <font size="3">  '+year_t+'</font>   <p></p>'								
									}

									if(!(month_t.includes(undefined))){
										texto+=	'<p><font size="5"><strong>Month:</strong></font</p>   <font size="3">'+month_t+' </font>   <p></p>'								
									}
									if(!(dayofMonth_t.includes(undefined))){
										texto+=	'<p><font size="5"><strong>Day:</strong</font></p>  <font size="3"> '+dayofMonth_t+' </font>   <p></p>'								
									}
									if(!(day_t.includes(undefined))){
										texto+=	'<p><font size="5"><strong>Day of the Week:</strong></font</p>   <font size="3">'+day_t+'</font>    <p></p>'								
									}

									if(!(hour_t.includes(undefined))){
										texto+=	'<p><font size="5"><strong>Hour:</strong></font</p>  <font size="3"> '+hour_t+' </font>   <p></p>'								
									}
									if(!(daynight_t.includes(undefined))){
										texto+=	'<p><font size="5"><strong>Day/Night:</strong></font</p>  <font size="3">'+daynight_t+' </font>   <p></p>'								
									}
									if(!(weekmonth_t.includes(undefined))){
										texto+=	'<p><font size="5"><strong>Week Of The Month:</strong></font</p>   <font size="3">'+weekmonth_t+'</font>    <p></p>'								
									}

									if(!(isWeekDay_t.includes(undefined))){
										texto+=	'<p><font size="5"><strong>Is Weekday:</strong></font></p>  <font size="3">'+isWeekDay_t+'</font>'							
									}

									//texto+='<div id="list3" align="left"></div>    <div id="temporal"align="center"></div>'


									document.getElementById("temporal_id").innerHTML=texto

								/*$('input[id="year"]').change(function() {
									console.log("cambioooooo    "+ this.value)	
									console.log($(this).prop('checked'))	
									if()				
								})	*/

								var value = 1;

								var checkbox =  document.getElementsByTagName('input')

								for(var i=0;i<checkbox.length;i++){
									if(checkbox[i].getAttribute('type')=='checkbox'){
											checkbox[i].checked = value
									}
								}


					var datos=completedata;

					var year_removed=null;
					var daynight_removed=null;
					var day_removed=null;
					var month_removed=null;
					var weekmonth_removed=null;
					var isWeekDay_removed=null;	
					var hour_removed=null;
					var dayMonth_removed=null;
					var hour_removed=null;

					$('input[id="year"]').change(function() {
						console.log(this.value)
						if(!this.checked){
							console.log("cambiooooooooooooooooooooooooooo   "+this.value)
							//datos=completedata
							year_removed=datos.filter(d=>(d.Year==this.value))
							datos=datos.filter(d=>!(d.Year==this.value))
							console.log(datos)	
							if(datos.length>0){
								container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
								container.layoutManager.eventHub.emit( 'datosvisibles', datos );

								if(this.value=='diurnal'){
									slider3.conf.set=[6,18]
									console.log(slider3.conf.set)
									console.log(slider3)
								}
							}
							else{
								alert('Your current filtered data has no attribute: "'+this.value+'" or is the only value existent in its column')
							}							 
						}	
						else{
							console.log("removed: "+year_removed.length)

							year_removed.map(function(e){
								if(!datos.includes(e))
									datos.push(e)
							})
							container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
							container.layoutManager.eventHub.emit( 'datosvisibles', datos );

						}					
					})

					$('input[id="month"]').change(function() {
						if(!this.checked){
							console.log("cambiooooooooooooooooooooooooooo   "+this.value)
							//datos=completedata
							month_removed=datos.filter(d=>(d.Month==this.value))
							datos=datos.filter(d=>!(d.Month==this.value))
							console.log(datos)	
							if(datos.length>0){
								container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
								container.layoutManager.eventHub.emit( 'datosvisibles', datos );
							}
							else{
								alert('Your current filtered data has no attribute: "'+this.value+'" or is the only value existent in its column')
							}	
						}
						else{
							console.log("removed: "+month_removed.length)

							month_removed.map(function(e){
								if(!datos.includes(e))
									datos.push(e)
							})
							container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
							container.layoutManager.eventHub.emit( 'datosvisibles', datos );

						}	

						
					})

					$('input[id="dayofMonth"]').change(function() {
						if(!this.checked){
							console.log("cambiooooooooooooooooooooooooooo   "+this.value)
							//datos=completedata
							dayMonth_removed=datos.filter(d=>(d.Day==this.value))
							datos=datos.filter(d=>!(d.Day==this.value))
							console.log(datos)	
							if(datos.length>0){
								container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
								container.layoutManager.eventHub.emit( 'datosvisibles', datos );
							}
							else{
								alert('Your current filtered data has no attribute: "'+this.value+'" or is the only value existent in its column')
							}	
						}
						else{
							console.log("removed: "+dayMonth_removed.length)

							dayMonth_removed.map(e=>datos.push(e))
							container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
							container.layoutManager.eventHub.emit( 'datosvisibles', datos );

						}	
						
					})


					$('input[id="day"]').change(function() {
						if(!this.checked){
							console.log("cambiooooooooooooooooooooooooooo   "+this.value)
							//datos=completedata
							day_removed=datos.filter(d=>(d.DayOfTheWeek==this.value))
							datos=datos.filter(d=>!(d.DayOfTheWeek==this.value))
							console.log(datos)	
							if(datos.length>0){
								container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
								container.layoutManager.eventHub.emit( 'datosvisibles', datos );
							}
							else{
								alert('Your current filtered data has no attribute: "'+this.value+'" or is the only value existent in its column')
							}	
						}
						else{
							console.log("removed: "+day_removed.length)

							day_removed.map(function(e){
								if(!datos.includes(e))
									datos.push(e)
							})
							container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
							container.layoutManager.eventHub.emit( 'datosvisibles', datos );

						}	
						
					})

					$('input[id="hour"]').change(function() {
						if(!this.checked){
							console.log("cambiooooooooooooooooooooooooooo   "+this.value)
							//datos=completedata
							hour_removed=datos.filter(d=>(d.Hours==this.value))
							datos=datos.filter(d=>!(d.Hours==this.value))
							console.log(datos)	
							if(datos.length>0){
								container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
								container.layoutManager.eventHub.emit( 'datosvisibles', datos );
							}
							else{
								alert('Your current filtered data has no attribute: "'+this.value+'" or is the only value existent in its column')
							}	
						}
						else{
							console.log("removed: "+hour_removed.length)

							hour_removed.map(e=>datos.push(e))
							container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
							container.layoutManager.eventHub.emit( 'datosvisibles', datos );

						}	
						
					})





					$('input[id="daynight"]').change(function() {
						console.log(this.value)
						if(!this.checked){
							console.log("cambiooooooooooooooooooooooooooo   "+this.value)
							//datos=completedata
							daynight_removed=datos.filter(d=>(d.DayNight==this.value))
							datos=datos.filter(d=>!(d.DayNight==this.value))
							console.log(datos)	
							if(datos.length>0){
								container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
								container.layoutManager.eventHub.emit( 'datosvisibles', datos );

								if(this.value=='diurnal'){
									slider3.conf.set=[6,18]
									console.log(slider3.conf.set)
									console.log(slider3)
								}
							}
							else{
								alert('Your current filtered data has no attribute: "'+this.value+'" or is the only value existent in its column')
							}							 
						}	
						else{
							console.log("removed: "+daynight_removed.length)

							daynight_removed.map(function(e){
								if(!datos.includes(e))
									datos.push(e)
							})
							container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
							container.layoutManager.eventHub.emit( 'datosvisibles', datos );

						}					
					})

					

					


					$('input[id="weekmonth"]').change(function() {
						if(!this.checked){
							console.log("cambiooooooooooooooooooooooooooo   "+this.value)
							//datos=completedata
							weekmonth_removed=datos.filter(d=>(d.WeekOfTheMonth==this.value))
							datos=datos.filter(d=>!(d.WeekOfTheMonth==this.value))
							console.log(datos)	
							if(datos.length>0){
								container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
								container.layoutManager.eventHub.emit( 'datosvisibles', datos );
							}
							else{
								alert('Your current filtered data has no attribute: "'+this.value+'" or is the only value existent in its column')
							}	
						}
						else{
							console.log("removed: "+weekmonth_removed.length)

							weekmonth_removed.map(function(e){
								if(!datos.includes(e))
									datos.push(e)
							})
							container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
							container.layoutManager.eventHub.emit( 'datosvisibles', datos );

						}	
						
					})

					$('input[id="isWeekDay"]').change(function() {

						if(!this.checked){
							console.log("cambiooooooooooooooooooooooooooo   "+this.name)
							//datos=completedata
							isWeekDay_removed=datos.filter(d=>(console.log(d.isWeekDay==this.name)))
							datos=datos.filter(d=>!(d.isWeekDay==this.name))
							console.log(datos)	
							if(datos.length>0){
								container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
								container.layoutManager.eventHub.emit( 'datosvisibles', datos );
							}
							else{
								alert('Your current filtered data has no attribute: "'+this.name+'" or is the only value existent in its column')
							}	
						}
						else{
							console.log("removed: "+isWeekDay_removed.length)

							isWeekDay_removed.map(e=>datos.push(e))
							container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );	
							container.layoutManager.eventHub.emit( 'datosvisibles', datos );

						}	
						
					})
						

							},500)



						
						}
						else{
							document.getElementById("list3").innerHTML = '<strong> <font size="3">THERE ARE NOT TEMPORAL ATTRIBUTES THAT PERMITS ANY TEMPORAL ANALYSIS </font></strong>'
						}
					});
				});
				
	}])
	boxplotApp.controller('boxplotController', ["$scope",'$timeout',"container","state","TestService",function( $scope,$timeout,container, state,TestService ) {	
		container.layoutManager.eventHub.on( 'columnasSeq_list', function( cols ){
				container.layoutManager.eventHub.on( 'redrawVisibleData', function( returnData ){
					
					if(returnData[0].hasOwnProperty("Year")){
						document.getElementById("list4").innerHTML = '<strong>Select Quantitative Value: </strong> <input list="attrs4" type="text" id="attr4"><datalist id="attrs4">'+cols				
						function onlyUnique(value, index, self) { 
						    return self.indexOf(value) === index;
						}
						var years_temp=[]
							var years = returnData.map(function(d){
								years_temp.push(parseInt(d.Year))				
							})
						var years_temp_array = years_temp.filter(onlyUnique)
						if(returnData[0].hasOwnProperty("Month")){
							var months_temp=[]
								var months = returnData.map(function(d){
									months_temp.push(parseInt(d.Date.getMonth()))				
								})
							var months_temp_array = months_temp.filter(onlyUnique)
						}
						
						d3.select("#attr4").on("change", function(){
							document.getElementById("list5").innerHTML = '<strong>Select between the values of "PERCENTILE" / "INTERQUARTILE RANGE" / OUTLIERS as you prefer to filter the current data: </strong> <input list="attrs5" type="text" id="attr5"><datalist id="attrs5"><option value="0-25th Percentile [MIN <-> Q1]"><option value="25th-50th Percentile [Q1 <-> Q2 (Median)]"><option value="50th-75th Percentile [Q2 (Median) <-> Q3]"><option value="75th-100th Percentile [Q3 <-> MAX]"><option value="Interquartile Range"><option value="Outliers">'//'<option value="COMPLETE DATA">'
							var attr4 = this.value;							
							console.log("Selected Value Attr4: "+attr4)		
							var data=[]
							var colors = [];
							while (colors.length < 100) {
							    do {
							        var color = Math.floor((Math.random()*1000000)+1);
							    } while (colors.indexOf(color) >= 0);
							    colors.push("#" + ("000000" + color.toString(16)).slice(-6));
							}							
							var new_colors=[];
							if(colors.length>years_temp_array.length){
								new_colors=colors.slice(0,years_temp_array.length+1)
							}	

							for(var i=0;i<years_temp_array.length;i++){	
								if (i!=0){				
									new_colors.pop()
								}
								var temp_array_int=[]
								returnData.filter(d=>parseInt(d.Year)==years_temp_array[i]).map(function(d){
									temp_array_int.push(parseInt(d[attr4]))
								})
								console.log(temp_array_int)
								for(var j=0;j<new_colors.length;j++){
									data[i]={
									  y: temp_array_int,
									  type: 'box',
									  name: "Year:  "+years_temp_array[i],
									  marker: {
									    color: new_colors[j],
									    outliercolor: 'rgb(219, 64, 82, 0.6)',
									    line: {
									      outliercolor: 'rgb(219, 64, 82, 1.0)',
									      outlierwidth: 2
									    }
									  },
									  boxpoints: 'all'
									};
								}
								
							}
							var layout = {
							  title: 'Representation: Box Plot'
							};
							Plotly.newPlot('boxplot', data, layout);
							d3.select("#attr5").on("change", function(){
								var attr5 = this.value;
								var valores=[];
								returnData.map(function(d){								
									valores.push(parseInt(d[attr4]))								
									valores.sort(function(a, b){return a-b});
									console.log(valores)
								})
								function isOdd(num) { return num % 2;}
								function calcShowPercentiles(returnData,attr5,attr4,value_Q1,value_median,value_Q3,value_min,value_max){
									var data_filter=[]
									if(attr5=='25th-50th Percentile [Q1 <-> Q2 (Median)]'){
										returnData.filter(d=>parseInt(d[attr4])>=value_Q1 && parseInt(d[attr4])<value_median).map(function(d){					
											data_filter.push(d)										
										})
										if(data_filter!=null || data_filter!=undefined){
											document.getElementById("counter").innerHTML = '<strong>'+data_filter.length+'</strong> values were filtered\nbetween the <strong>25th-50th Percentile [Q1 <-> Q2 (Median)]</strong>'
											container.layoutManager.eventHub.emit( 'redrawVisibleData', data_filter );
											container.layoutManager.eventHub.emit( 'datosvisibles', data_filter );

										}	
									}
									if(attr5=='0-25th Percentile [MIN <-> Q1]'){
										returnData.filter(d=>parseInt(d[attr4])>=value_min && parseInt(d[attr4])<value_Q1).map(function(d){					
											data_filter.push(d)										
										})
										if(data_filter!=null || data_filter!=undefined){
											datos=data_filter
											document.getElementById("counter").innerHTML = 'strong>'+returnData.length+'</strong> values were filtered\nbetween the <strong> 0-25th Percentile [MIN <-> Q1] </strong>'
											container.layoutManager.eventHub.emit( 'redrawVisibleData', returnData );
											container.layoutManager.eventHub.emit( 'datosvisibles', returnData );											
										}
									}
									if(attr5=='50th-75th Percentile [Q2 (Median) <-> Q3]'){
										returnData.filter(d=>parseInt(d[attr4])>=value_median && parseInt(d[attr4])<value_Q3).map(function(d){					
											data_filter.push(d)										
										})
										if(data_filter!=null || data_filter!=undefined){
											document.getElementById("counter").innerHTML = '<strong>'+data_filter.length+'</strong> values were filtered\nbetween the <strong> 50th-75th Percentile [Q2 (Median) <-> Q3] </strong>'
											container.layoutManager.eventHub.emit( 'redrawVisibleData', data_filter );
											container.layoutManager.eventHub.emit( 'datosvisibles', data_filter );											
										}	
									}
									if(attr5=='75th-100th Percentile [Q3 <-> MAX]'){
										returnData.filter(d=>parseInt(d[attr4])>=value_Q3 && parseInt(d[attr4])<value_max).map(function(d){					
											data_filter.push(d)										
										})
										if(data_filter!=null || data_filter!=undefined){
											document.getElementById("counter").innerHTML = '<strong>'+data_filter.length+'</strong> values were filtered\nbetween the <strong> 75th-100th Percentile [Q3 <-> MAX] </strong>'
											container.layoutManager.eventHub.emit( 'redrawVisibleData', data_filter );
											container.layoutManager.eventHub.emit( 'datosvisibles', data_filter );											
										}	
									}
									if(attr5=='Interquartile Range'){
										returnData.filter(d=>parseInt(d[attr4])>=value_Q1 && parseInt(d[attr4])<=value_Q3).map(function(d){					
											data_filter.push(d)										
										})
										if(data_filter!=null || data_filter!=undefined){
											document.getElementById("counter").innerHTML = '<strong>'+data_filter.length+'</strong> values were filtered\nbetween the <strong> Interquartile Range </strong>'
											container.layoutManager.eventHub.emit( 'redrawVisibleData', data_filter );
											container.layoutManager.eventHub.emit( 'datosvisibles', data_filter );												
										}
									}
									if(attr5=='Outliers'){
										returnData.filter(d=>parseInt(d[attr4])<value_min && parseInt(d[attr4])>value_max).map(function(d){					
											data_filter.push(d)										
										})

										if(data_filter.length>0){
											document.getElementById("counter").innerHTML = '<strong>'+data_filter.length+' values were filtered\nas Outliers </strong>'
											container.layoutManager.eventHub.emit( 'redrawVisibleData', data_filter );
											container.layoutManager.eventHub.emit( 'datosvisibles', data_filter );											
										}
										else{
											setTimeout(function(){
												alert("There are not -Ouliers- in your Selection")
											},400)
										}	
									}
									/*if(attr5=='COMPLETE DATA'){	
										console.log(returnData)									
										//datos=returnData;
										document.getElementById("counter").innerHTML = '<strong> SHOWING\n'+datos.length+' from the original loaded data </strong>'	
										//returnData=data_filter
										container.layoutManager.eventHub.emit( 'redrawVisibleData', returnData );
										container.layoutManager.eventHub.emit( 'datosvisibles', returnData );																		
									}*/

									container.layoutManager.eventHub.on( 'datos', function( data ){
											console.log(data)
											$('button[id="complete_data_btn"]').click(function() {  

												console.log("CLICK COMPLETE")

												data_filter=data										
											   	document.getElementById("counter").innerHTML = '<strong> SHOWING\n'+data_filter.length+' from the original loaded data </strong>'
											   	container.layoutManager.eventHub.emit( 'redrawVisibleData', data_filter );
												container.layoutManager.eventHub.emit( 'datosvisibles', data_filter );	
																   
											});	
									})	




								}
									
								console.log("valores:   "+valores)
								console.log("tamao:    "+ valores.length)
								var value_median=math.median(valores)
								var _firstHalf = valores.filter(function(f){ return f < value_median })
    							var _secondHalf = valores.filter(function(f){ return f >= value_median })
    							var _25percent = math.median(_firstHalf);
    								console.log("Q1:   "+_25percent)
    							var _50percent = value_median;
    								console.log("MEDIAN:  "+_50percent)
    							var _75percent = math.median(_secondHalf);
    								console.log("Q3:    "+_75percent)  						
   							
								var interquartile_range = _75percent - _25percent;
									console.log("Interquartile Range:  "+interquartile_range)
								var value_min= _25percent - (1.5*interquartile_range)
									console.log("Min Value:  "+value_min)
								var value_max= _75percent + (1.5*interquartile_range)
									console.log("Max Value:  "+value_max)									
								
								calcShowPercentiles(returnData,attr5,attr4,_25percent,_50percent,_75percent,value_min,value_max)	
								container.layoutManager.eventHub.emit('attr4_value',attr4)		
							})
						})

						


					}
					else{
						document.getElementById("list4").innerHTML = '<strong><font size="3"> THERE ARE NOT ANY TEMPORAL ATTRIBUTES THAT PERMITS THE PRELIMINARY STATISTICAL ANALYSIS </font></strong>'
					}
				})	
			})
	}])
	mapApp.controller('mapController', ["$scope",'$timeout',"container","state","TestService",function( $scope,$interval,container, state,TestService ) {

		var mymap=null;	
		var markers=null;
		setTimeout(function(){
				mymap = new L.Map('mapid')	
				markers = new L.MarkerClusterGroup({
					iconCreateFunction: function(cluster) {
						var childCounter= parseInt(cluster.getChildCount()+1)
						return L.divIcon({ html: '<b><font size="5">' + cluster.getChildCount() + '</font></b>',iconSize: new L.Point(40, 40) });
					}	
				}).addTo(mymap);

				L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
					attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
					}).addTo(mymap);

				new L.Control.Draw({
						    draw: {
						        marker   : false,
						        polygon  : true,
						        polyline : false,
						        rectangle: true,
						        circle   : {
						            metric: 'metric'
						        }
						    },
						    edit: false
						}).addTo(mymap);

				
		container.layoutManager.eventHub.on( 'completedata', function( completedata ){
				L.easyButton('<img src="https://cdn.onlinewebfonts.com/svg/img_351337.png" style="width:20px">',function(btn,map){
					
							container.layoutManager.eventHub.emit( 'redrawVisibleData', completedata );
							container.layoutManager.eventHub.emit( 'datosvisibles', completedata );				
					
				}).addTo(mymap)
		})



				

		},500)

		/*if(mymap!=undefined||mymap!=null){
				clearInterval(initiate_map);
		}*/
			
		container.layoutManager.eventHub.on( 'completedata', function( completedata ){
			container.layoutManager.eventHub.on( 'datosvisibles', function( datos ){
				var list_markers=[]
				var list_remaining=[]
				console.log(datos)
				if(completedata[0].hasOwnProperty('Latitude') && completedata[0].hasOwnProperty('Longitude')){
					function init(){

						var long=[]
						var lat=[]	

						datos.map(function(d){
							long.push(d.Longitude)
							lat.push(d.Latitude)
						
							var max_latitudes=Math.max.apply(Math,lat)
							var min_latitudes=Math.min.apply(Math,lat)
							var max_longitudes=Math.max.apply(Math,long)
							var min_longitudes=Math.min.apply(Math,long)
							prom_latitudes= (max_latitudes+min_latitudes)/2;
							prom_longitudes=(max_longitudes+min_longitudes)/2;
						
						})

						mymap.setView([prom_latitudes, prom_longitudes], 7);							 					
						draw(markers);
					}

					
					function draw(markers){	
						var prom_latitudes=[];
						var prom_longitudes=[];
						var lat=[];
						var long=[];
						var previous_counter=0;	
						var counter=1;						
						

							markers.clearLayers();	
							if(datos[0].hasOwnProperty('Year')){
								var years =[];
								var lista=[];
								var colors = ['black','green','orange','blue','red','fuchsia','cyan','purple','teal'];	
								datos.map(function(d){
									years.push(d.Year)
									years=years.filter(function(item, pos){
										return years.indexOf(item)== pos; 
									});
								})								
								for(var k=0;k<years.length;k++){	
									if (k!=0){										
										colors.pop()	
									}				
									var latitudes = [];
									var longitudes=[];							
									var datos_filter=datos.filter(d=>d.Year==years[k]).map(function(d){	
										if(d.Latitude!="" && d.Longitude!=""){					
											latitudes.push(parseFloat(d.Latitude))
											longitudes.push(parseFloat(d.Longitude))								
										}
									})									
														
									for(var i=0;i<datos_filter.length;i++){
										
										var coord = [latitudes[i],longitudes[i]];
										lista.push(coord)
										counter=counter+1;
									}	
									var identificators=[]
									datos.map(function(d){
										identificators.push(d['ID'])
									})
									var dates=[]
									datos.map(function(d){
										dates.push(d['Month']+" / "+d['Day']+" / "+d['Year']+"  ("+d['DayOfTheWeek']+")")
									})	
									list_markers=[]				
									for(var b=previous_counter;b<counter;b++){								
										if(b==counter-1){
											previous_counter=counter										
										}
										else{
											if(lista[b]!=undefined || lista[b]!=null){
										 		var marker= new L.circleMarker(lista[b],{fillOpacity:0.5,color:colors[k]}).addTo(markers).bindPopup("The coordinates of the current point are:\n\n<b>["+lista[b]+"]</b>\n\n\n <b>Identificator: "+identificators[b]+"</b> from the <b>Date: "+dates[b]+"</b>");//.addTo(mymap)
												//
												list_markers.push(marker)
											}									
										}																										
									}		
								}									
							}			
						

						setInterval(function(){ mymap.invalidateSize()}, 400);
					}													

					init();
					/*L.easyButton('<img src="https://cdn.onlinewebfonts.com/svg/img_351337.png" style="width:20px">',function(btn,map){
						container.layoutManager.eventHub.emit( 'redrawVisibleData', completedata );
						container.layoutManager.eventHub.emit( 'datosvisibles', completedata );
					}).addTo(mymap)*/
					L.Polygon.include({
					contains: function (latLng) {
					    return turf.inside(new L.circleMarker(latLng).toGeoJSON(), this.toGeoJSON());
					} 
					});
					L.Rectangle.include({
					contains: function (latLng) {
					    return this.getBounds().contains(latLng);
					}
					});
					L.Circle.include({
					contains: function (latLng) {
					    return this.getLatLng().distanceTo(latLng) < this.getRadius();
					}
					});
					mymap.on(L.Draw.Event.CREATED, function (e) {	
						console.log(markers)
						draw(markers)
						new_data=[]
						list_remaining=[]
						markers.eachLayer(function (marker) {
							console.log(marker)
						    if (!e.layer.contains(marker.getLatLng())) {
						        marker.remove();						            
								id_tag = marker,
								position = list_markers.indexOf(id_tag);
								if ( ~position ) list_markers.splice(position, 1);										
						    }
						});

						for(var i=0;i<list_markers.length;i++){
							if(!list_remaining.includes(list_markers[i]['_popup']['_content'].split('Identificator: ')[1].split('</b>')[0])){
								list_remaining.push(list_markers[i]['_popup']['_content'].split('Identificator: ')[1].split('</b>')[0])		
							}						    					    	
						}

						console.log(list_remaining)


						datos.map(function(d){
							for(var i=0;i<list_remaining.length;i++){
								if(d['ID']==list_remaining[i]){
									new_data.push(d)
								}
							}
							datos=new_data
							console.log(datos)							   	
						})
						container.layoutManager.eventHub.emit( 'redrawVisibleData', datos );
						container.layoutManager.eventHub.emit( 'datosvisibles', datos );
						container.layoutManager.eventHub.emit( 'datos', datos );
					});	

				}	
			})
		})
	}])
	splomApp.controller('splomController', ["$scope",'$timeout',"container","state","TestService",function( $scope,$interval,container, state,TestService ) {
		container.layoutManager.eventHub.on( 'dateParseEvent', function( datPa ){
			console.log(datPa)
			container.layoutManager.eventHub.on( 'categoricsEvent', function( cat ){
			console.log(cat)	
					container.layoutManager.eventHub.on( 'datosvisibles', function( rows ){
						console.log(rows)
						container.layoutManager.eventHub.on( 'redrawVisibleData', function( returnData ){	
					console.log(returnData)
				
					var x=[]
					var lista ='';
					var lista_seq=[]
					for(var i =0;i<cat.length;i++){
						if(!(cat[i]=='__i'||cat[i]=='__seqId'||cat[i]=='visible'||cat[i]=='selected')){
							lista_seq.push('<option value="'+cat[i]+'">')	
						}						
					}
					lista=lista_seq.join('')					
					document.getElementById("list6").innerHTML = '<strong>Select an Attribute to segment the loaded data: </strong> <input list="attrs6" type="text" id="attr6"><datalist id="attrs6">'+lista	
					d3.select("#attr6").on("change", function(){
						var attr6 = this.value;
					    function unpack(rows, key) {
					        return rows.map(function(row) { return row[key.replace('.',' ')]; });
					    }
					    colors = []	
					    console.log(unpack(returnData, attr6))
						var values=unpack(returnData, attr6).filter((value, index, self) => self.indexOf(value) === index)
						var pl_colorscale= [];
						while (pl_colorscale.length < 100) {
						    do {
						        var color = Math.floor((Math.random()*1000000)+1);
						    } while (pl_colorscale.indexOf(color) >= 0);
						    pl_colorscale.push("#" + ("000000" + color.toString(16)).slice(-6));
						}
						
						var c=0;
						var attributes=[];
						for (k=0; k < values.length; k++) {
							for (i=0; i < unpack(returnData, attr6).length; i++) {	
								if(unpack(rows, attr6)[i]==values[k]){
									c=c+1/values.length
									console.log(unpack(returnData, attr6)[i] + "         "+values[k] + "     "+pl_colorscale[k])									
									colors.push(pl_colorscale[k])
									attributes.push(values[k])
								}								
							}						
						}  
						attributes=attributes.filter((value, index, self) => self.indexOf(value) === index)
						var att =[];
						
						for(var i =0;i<attributes.length;i++){							
								att.push('<option value="'+attributes[i]+'">')							
						}
						//att.push('<option value="SHOW COMPLETE DATA">')
						var att_text= att.join('')
						document.getElementById("list7").innerHTML = '<strong>Do you want to FILTER any of these current values of your selected attribute?\nSelect a value to filter: </strong> <input list="attrs7" type="text" id="attr7"><datalist id="attrs7">'+att_text					
						var filtered=[]
						d3.select("#attr7").on("change", function(){
							var attr7 = this.value;
							filtered=[]
							console.log(rows)
							rows.map(function(d){
								if(attr7=='SHOW COMPLETE DATA'){

									container.layoutManager.eventHub.on( 'datos', function( data ){
											$('button[id="complete_data_btn"]').click(function() {  

												filtered=data	
													
												   	
																   
											});	
									})										
								
								}
								else{
										var new_rows=rows.filter(e=>e[attr6]==attr7)
										console.log(new_rows)
										new_rows.map(function(a){
											if(!filtered.includes(a)){
												filtered.push(a)
											}
											
										})								
								}
							})
							console.log(filtered)							


					/*document.getElementById('btn_complete_splom').innerHTML='<p></p><p></p><button type="button" id="complete_data_btn_splom"> <strong>SHOW ('+completedata.length+' VALUES)</strong></button><p></p><p></p><p></p><p></p>'	
					$('button[id="complete_data_btn_splom"]').click(function() {  	

						filtered=[]

						filtered=completedata
						rows=filtered
											
						container.layoutManager.eventHub.emit( 'redrawVisibleData', rows );	
						container.layoutManager.eventHub.emit( 'datosvisibles', rows );	
						container.layoutManager.eventHub.emit( 'datos', rows );		   	
										   
					});*/
							
							
							rows=filtered
							console.log(rows)
							container.layoutManager.eventHub.emit( 'redrawVisibleData', rows );
							container.layoutManager.eventHub.emit( 'datosvisibles', rows );
							
						})
					    var axis = () => ({
					      showline:false,
					      zeroline:false,
					      gridcolor:'#ffff',
					      ticklen:5
					    })
					    var cols = Object.keys(rows[0]);
					    if(x.length>0){
					    	x=[]
					    }
						for(var i=0;i<cols.length;i++){
							if(!(cols[i]=='__i'||cols[i]=='__seqId'||cols[i]=='visible'||cols[i]=='Year'||cols[i]=='Minutes'||cols[i]=='Latitude'||cols[i]=='Longitude'||cols[i]=='Seconds'||cols[i]=='ID'||datPa.includes(cols[i])||cat.includes(cols[i]))){
								x.push({label:cols[i], values:unpack(rows,cols[i])})
							}
						}
						console.log(x)
					    var data = [{
					      type: 'splom',
					      dimensions: x,
					      text: unpack(rows, attr6),
					      marker: {
					        color: colors,
					        colorscale:pl_colorscale,
					        line: {
					          color: 'white',
					          width: 0.5
					        }
					      }
					    }]
					    var layout = {
					      title:'SPLOM Graphic - [Scatter Plot Matrix / Correlations]',
					      height: container.height + 1000,
					      width: container.width + 1000,
					      autosize: true,
					      hovermode:'closest',
					      dragmode:'select',
					      plot_bgcolor:'rgba(240,240,240, 0.95)',
					      xaxis:axis(),
					      yaxis:axis(),
					      xaxis2:axis(),
					      xaxis3:axis(),
					      xaxis4:axis(),
					      xaxis5:axis(),
					      yaxis2:axis(),
					      yaxis3:axis(),
					      yaxis4:axis(),
					      yaxis5:axis()
					    }
					    Plotly.newPlot('splomGraph', data, layout)	
					})
					})
					})
				})
			})			
	}])
	regressionApp.controller('regressionController', ["$scope",'$timeout',"container","state","TestService",function( $scope,$interval,container, state,TestService ) {
		container.layoutManager.eventHub.on( 'columnasSeq_list', function( cols ){	
			container.layoutManager.eventHub.on( 'datosvisibles', function( rows ){
				container.layoutManager.eventHub.on( 'redrawVisibleData', function( returnData ){
					document.getElementById("list8").innerHTML = '<strong>Select a Quantitative Attribute to segment the loaded data: </strong> <input list="attrs8" type="text" id="attr8"><datalist id="attrs8">'+cols
					document.getElementById("list9").innerHTML = '<strong>Select a Quantitative Attribute to segment the loaded data: </strong> <input list="attrs9" type="text" id="attr9"><datalist id="attrs9">'+cols											
					
					$("#regressionGraph").empty()
					d3.select("#attr8").on("change", function(){	
						var attr8 = this.value;
						d3.select("#attr9").on("change", function(){							
							$("#regressionGraph").empty()							
							var attr9 = this.value;		
							var datos_raw=[]
							var datos_raw2=[]
							returnData.map(function(d){									
								datos_raw2.push([d[attr8],d[attr9]])
								datos_raw.push([parseFloat(d[attr8]),parseFloat(d[attr9])])
							})
							console.log(datos_raw)
							console.log(datos_raw2)
							var rawData = datos_raw;
						
							var result = regression('linear', rawData);
							var coeff = result.equation;							
							anychart.onDocumentReady(function () {
							  var data_1 = rawData;
							  var data_2 = setTheoryData(rawData);
							  chart = anychart.scatter();
							  chart.title("The calculated formula: " + result.string + "\nThe coefficient of determination (R2): " + result.r2.toPrecision(2));
							  chart.legend(true);
							  var series1 = chart.marker(data_1);
							  series1.name("Experimental data");
							  var series2 = chart.line(data_2);
							  series2.name("Theoretically calculated data");
							  series2.markers(true);
							  chart.container("regressionGraph");
							  chart.draw();
							});
							function formula(coeff, x) {
							  var result = null;
							  for (var i = 0, j = coeff.length - 1; i < coeff.length; i++, j--) {
							    result += coeff[i] * Math.pow(x, j);
							  }
							  return result;
							}
							function setTheoryData(rawData) {
							  var theoryData = [];
							  for (var i = 0; i < rawData.length; i++) {
							    theoryData[i] = [rawData[i][0], formula(coeff, rawData[i][0])];
							  }
							  return theoryData;
							}		
						})
					})					
				})
			})
		})						
	}])
	mapESRIApp.controller('mapESRIController', ["$scope",'$timeout',"container","state","TestService",function( $scope,$interval,container, state,TestService ) {

		var map;

		require([
		"esri/config",
		"esri/InfoTemplate",
		"esri/map",
		"esri/request",
		"esri/geometry/scaleUtils",
		"esri/layers/FeatureLayer",
		"esri/renderers/SimpleRenderer",
		"esri/symbols/PictureMarkerSymbol",
		"esri/symbols/SimpleFillSymbol",
		"esri/symbols/SimpleLineSymbol",
		"dojo/dom",
		"dojo/json",
		"dojo/on",
		"dojo/parser",
		"dojo/sniff",
		"dojo/_base/array",
		"esri/Color",
		"dojo/_base/lang",
		"esri/dijit/Search",
		"esri/toolbars/draw",
        "esri/symbols/SimpleMarkerSymbol",
        "esri/symbols/PictureFillSymbol", "esri/symbols/CartographicLineSymbol", 
        "esri/graphic",         
		"dijit/layout/BorderContainer",
		"dijit/layout/ContentPane",
		"esri/layers/GraphicsLayer",
		"esri/geometry/Point",
		"dojo/domReady!"
		],
		function (
		esriConfig, InfoTemplate, Map, request, scaleUtils, FeatureLayer,
		SimpleRenderer, PictureMarkerSymbol, SimpleFillSymbol, SimpleLineSymbol,
		dom, JSON, on, parser, sniff, arrayUtils, Color, lang, Search,  Draw,
        SimpleMarkerSymbol, PictureFillSymbol, CartographicLineSymbol,Graphic,GraphicsLayer,Point 
		) {

		  parser.parse();

		  var portalUrl = "https://www.arcgis.com";

		  esriConfig.defaults.io.proxyUrl = "/proxy/";

		  on(dom.byId("uploadForm"), "change", function (event) {
		    var fileName = event.target.value.toLowerCase();

		    if (sniff("ie")) { //filename is full path in IE so extract the file name
		      var arr = fileName.split("\\");
		      fileName = arr[arr.length - 1];
		    }
		    if (fileName.indexOf(".zip") !== -1) {//is file a zip - if not notify user
		      generateFeatureCollection(fileName);
		    }
		    else {
		      dom.byId('upload-status').innerHTML = '<p style="color:red">Add shapefile as .zip file</p>';
		    }
		  });

		  map = new Map("mapCanvas", {
		    basemap: "streets-navigation-vector",
		    center: [-41.647, 36.41],
		    zoom: 3,
		    slider: false
		  });


			map.on("load", initToolbar);		

		  var markerSymbol = new SimpleMarkerSymbol();
        markerSymbol.setPath("M16,4.938c-7.732,0-14,4.701-14,10.5c0,1.981,0.741,3.833,2.016,5.414L2,25.272l5.613-1.44c2.339,1.316,5.237,2.106,8.387,2.106c7.732,0,14-4.701,14-10.5S23.732,4.938,16,4.938zM16.868,21.375h-1.969v-1.889h1.969V21.375zM16.772,18.094h-1.777l-0.176-8.083h2.113L16.772,18.094z");
        markerSymbol.setColor(new Color("#00FFFF"));

        var lineSymbol = new CartographicLineSymbol(
          CartographicLineSymbol.STYLE_SOLID,
          new Color([0,0,0]), 3, 
          CartographicLineSymbol.CAP_ROUND,
          CartographicLineSymbol.JOIN_MITER, 3
        );


        var fillSymbol = new PictureFillSymbol(
          "images/mangrove.png",
          new SimpleLineSymbol(
            SimpleLineSymbol.STYLE_SOLID,
            new Color('#000'), 
            1
          ), 
          42, 
          42
        );


        function initToolbar() {
          tb = new Draw(map);
          tb.on("draw-end", addGraphic);

          // event delegation so a click handler is not
          // needed for each individual button
          on(dom.byId("info"), "click", function(evt) {
            if ( evt.target.id === "info" ) {
              return;
            }
            var tool = evt.target.id.toLowerCase();
            map.disableMapNavigation();
            tb.activate(tool);
          });
        }

        function addGraphic(evt) {
          //deactivate the toolbar and clear existing graphics 
          tb.deactivate(); 
          map.enableMapNavigation();

          // figure out which symbol to use
          var symbol;
          if ( evt.geometry.type === "point" || evt.geometry.type === "multipoint") {
            symbol = markerSymbol;
          } else if ( evt.geometry.type === "line" || evt.geometry.type === "polyline") {
            symbol = lineSymbol;
          }
          else {
            symbol = fillSymbol;
          }

          map.graphics.add(new Graphic(evt.geometry, symbol));
        }

			var search = new Search({
				map: map
			}, "search");

			search.startup();


		  function generateFeatureCollection (fileName) {
		    var name = fileName.split(".");
		    //Chrome and IE add c:\fakepath to the value - we need to remove it
		    //See this link for more info: http://davidwalsh.name/fakepath
		    name = name[0].replace("c:\\fakepath\\", "");

		    dom.byId('upload-status').innerHTML = '<b>Loading </b>' + name;

		    //Define the input params for generate see the rest doc for details
		    //http://www.arcgis.com/apidocs/rest/index.html?generate.html
		    var params = {
		      'name': name,
		      'targetSR': map.spatialReference,
		      'maxRecordCount': 1000,
		      'enforceInputFileSizeLimit': true,
		      'enforceOutputJsonSizeLimit': true
		    };

		    //generalize features for display Here we generalize at 1:40,000 which is approx 10 meters
		    //This should work well when using web mercator.
		    var extent = scaleUtils.getExtentForScale(map, 40000);
		    var resolution = extent.getWidth() / map.width;
		    params.generalize = true;
		    params.maxAllowableOffset = resolution;
		    params.reducePrecision = true;
		    params.numberOfDigitsAfterDecimal = 0;

		    var myContent = {
		      'filetype': 'shapefile',
		      'publishParameters': JSON.stringify(params),
		      'f': 'json',
		      'callback.html': 'textarea'
		    };

		    //use the rest generate operation to generate a feature collection from the zipped shapefile
		    request({
		      url: portalUrl + '/sharing/rest/content/features/generate',
		      content: myContent,
		      form: dom.byId('uploadForm'),
		      handleAs: 'json',
		      load: lang.hitch(this, function (response) {
		        if (response.error) {
		          errorHandler(response.error);
		          return;
		        }
		        var layerName = response.featureCollection.layers[0].layerDefinition.name;
		        dom.byId('upload-status').innerHTML = '<b>Loaded: </b>' + layerName;
		        addShapefileToMap(response.featureCollection);
		        var argis_attributes=[]
			    for (var i=0;i<response.featureCollection.layers[0].featureSet.features.length;i++){
					argis_attributes.push(response.featureCollection.layers[0].featureSet.features[i].attributes)
			    }
			    console.log(argis_attributes)
			    container.layoutManager.eventHub.emit( 'argis_attributes', argis_attributes );
		      }),
		      error: lang.hitch(this, errorHandler)
		    });
		  }

		  function errorHandler (error) {
		    dom.byId('upload-status').innerHTML =
		    "<p style='color:red'>" + error.message + "</p>";
		  }

		  function addShapefileToMap (featureCollection) {
		    //add the shapefile to the map and zoom to the feature collection extent
		    //If you want to persist the feature collection when you reload browser you could store the collection in
		    //local storage by serializing the layer using featureLayer.toJson()  see the 'Feature Collection in Local Storage' sample
		    //for an example of how to work with local storage.
		    var fullExtent;
		    var layers = [];

		    	    
		    arrayUtils.forEach(featureCollection.layers, function (layer) {
		      var infoTemplate = new InfoTemplate("Details", "${*}");		     
		      var featureLayer = new FeatureLayer(layer, {
		        infoTemplate: infoTemplate
		      });    
		     
		     
     		 
     		  //argis_attributes.push(layer.featureSet.features[i].attributes)
		     
		     
		     //associate the feature with the popup on click to enable highlight and zoom to
		      featureLayer.on('click', function (event) {
		      	map.infoWindow.setFeatures([event.graphic]);	
		      	var actual_upz=null;
		        actual_upz=event.graphic.attributes.UPZ
		       	console.log(actual_upz)
				container.layoutManager.eventHub.emit( 'actual_upz', actual_upz );	        
		      });

		    



		      //change default symbol if desired. Comment this out and the layer will draw with the default symbology
		      changeRenderer(featureLayer);
		      fullExtent = fullExtent ?
		        fullExtent.union(featureLayer.fullExtent) : featureLayer.fullExtent;
		      layers.push(featureLayer);
		    });   
					   
		    map.addLayers(layers);
		    map.setExtent(fullExtent.expand(1.25), true);

		    dom.byId('upload-status').innerHTML = "";

		 }

		  function changeRenderer (layer) {
		    //change the default symbol for the feature collection for polygons and points
		    var symbol = null;
		    switch (layer.geometryType) {
		      case 'esriGeometryPoint':
		        symbol = new PictureMarkerSymbol({
		          'angle': 0,
		          'xoffset': 0,
		          'yoffset': 0,
		          'type': 'esriPMS',
		          'url': 'https://static.arcgis.com/images/Symbols/Shapes/BluePin1LargeB.png',
		          'contentType': 'image/png',
		          'width': 20,
		          'height': 20
		        });
		        break;
		      case 'esriGeometryPolygon':
		        symbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID,
		          new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID,
		            new Color([112, 112, 112]), 1), new Color([136, 136, 136, 0.25]));
		        break;
		    }
		    if (symbol) {
		      layer.setRenderer(new SimpleRenderer(symbol));
		    }
		  }
		}); 	
	}])
	bubbleApp.controller('bubbleController', ["$scope",'$timeout',"container","state","TestService",function( $scope,$timeout,container, state,TestService ) { 

		setTimeout(function(){	

			container.layoutManager.eventHub.on( 'columnasSeq_list', function( cols ){
				container.layoutManager.eventHub.on( 'datosvisibles', function( rows ){		

					if(rows[0].hasOwnProperty('Latitude') && rows[0].hasOwnProperty('Longitude')){

						document.getElementById("list10").innerHTML='<p></p><strong>Select Quantitative Value: </strong> <input list="attrs10" type="text" id="attr10"><datalist id="attrs10">'+cols		
						d3.select("#attr10").on("change", function(){
							var attr10 = this.value;
							var serie=[]
							rows.map(function(d){
								serie.push([d.Longitude, d.Latitude,parseInt(d[attr10])])								
							})

							console.log(serie)

							var chart =Highcharts.chart('bubbleGraph', {

							    chart: {
							        type: 'bubble',
							        plotBorderWidth: 1,
							        zoomType: 'xy'
							    },

							    title: {
							        text: 'Spatial BubbleChart'
							    },

							    xAxis: {
							        gridLineWidth: 1
							    },

							    yAxis: {
							        startOnTick: false,
							        endOnTick: false
							    },

							    plotOptions: {
							        bubble: {
							            minSize: 3,
							            maxSize: 50
							        }
							    },

							    series: [{
							        data: serie
							    }]

							});
						chart.series[0].update({name:attr10}, false);
						chart.redraw();
						})

					}
					else{
						document.getElementById('bubbleid').innerHTML='<p></p><strong> <font size="3">YOUR DATA DOES NOT HAVE EXPLICIT SPATIAL COORDINATES [LATITUDE , LONGITUDE] TO DISPLAY THIS VISUALIZATION</font></strong>'
					}
				});	
			});	
		},500)		
	}])
	ESRI_OSMApp.controller('ESRI_OSM_Controller', ["$scope",'$timeout',"container","state","TestService",function( $scope,$timeout,container, state,TestService ) { 
		setTimeout(function(){
		document.getElementById('ESRI_OSM_id').innerHTML=`<div id="map"></div>  <script src="js/leaflet.js"><\/script> <script src="js/leaflet.hash.js"><\/script>  <script src='jam/require.js'><\/script>  <script src='js/leaflet.spin.js'><\/script> <script src='js/mapSetup.js'><\/script> <script src='script.js'><\/script>`

			var codes = document.getElementById('ESRI_OSM_id').getElementsByTagName("script");



			for(var i=0;i<codes.length;i++)  
			{  				
				console.log(codes[i])
				console.log(codes[i].text)
				eval(codes[i]);  

			}  
		},500)
	}])
	

	var app1El = document.getElementById('fileselector');
	var app2El = document.getElementById('navio');
	var app3El = document.getElementById('spatialviz');
	var app4El = document.getElementById('temporalviz');
	var app5El = document.getElementById('boxplot');
	var app6El = document.getElementById('map');
	var app7El = document.getElementById('splom');
	var app8El = document.getElementById('regression');
	var app9El = document.getElementById('mapESRI');
	var app10El = document.getElementById('bubble');
	var app11El = document.getElementById('ESRI_OSM');
	angular.bootstrap(app1El, ['fileselector', 'test-service']);
	angular.bootstrap(app2El, ['navio', 'test-service']);
	angular.bootstrap(app3El, ['spatialviz', 'test-service']);
	angular.bootstrap(app4El, ['temporalviz', 'test-service']);
	angular.bootstrap(app5El, ['boxplot', 'test-service']);
	angular.bootstrap(app6El, ['map', 'test-service']);
	angular.bootstrap(app7El, ['splom', 'test-service']);
	angular.bootstrap(app8El, ['regression', 'test-service']);
	angular.bootstrap(app9El, ['mapESRI', 'test-service']);
	angular.bootstrap(app10El, ['bubble', 'test-service']);
	angular.bootstrap(app11El, ['ESRI_OSM', 'test-service']);
	var AngularModuleComponent = function( container, state ) {
	    var html = $( '#' + state.templateId ).html(),
	        element = container.getElement();
	    
	    element.html( html );
	 
	    angular
	        .module( state.module )
	        .value( 'container', container )
	        .value( 'state', state );
	    angular.bootstrap( element[ 0 ], [ state.module ] );
	};
	var myLayout = new GoldenLayout({
	    content:[{
	        type: 'row',
	        content: [{
	        	type: 'column',
	      		content: [{
		            width: 20,
		            title: 'File Picker',
		            type: 'component',
		            componentName: 'angularModule',
		            componentState: {
		                module: 'fileselector',
		                templateId: 'fileselectorTemplate',
		            }
	        },{
	            type: 'component',
	            title: 'WHAT - Widget: Navio',
	            componentName: 'angularModule',
	            componentState: {
	                module: 'navio',
	                templateId: 'navioTemplate'
	            }
	        }]},{
	        type: 'column',
	        content: [{
	        	 type: 'stack',
	       		 content: [{
                type: 'component',
                title: 'ESRI Map',
                componentName: 'angularModule',
                componentState: {
                    module: 'mapESRI',
                    templateId: 'mapESRITemplate'
                }
            }/*,{
                type: 'component',
                title: 'ESRI - OSM Map',
                componentName: 'angularModule',
                componentState: {
                    module: 'ESRI_OSM',
                    templateId: 'ESRI_OSM_Template'
                }
            }*/,{
                type: 'component',
                title: 'Geo-Referentiation',
                componentName: 'angularModule',
                componentState: {
                    module: 'map',
                    templateId: 'mapTemplate'
                }
            },{
                type: 'component',
                title: 'Spatial BubbleChart',
                componentName: 'angularModule',
                componentState: {
                    module: 'bubble',
                    templateId: 'bubbleTemplate'
                }
            }]
            },{
            	 type: 'stack',
	       		 content: [{
	                type: 'component',
	                title: 'Box Plot',
	                componentName: 'angularModule',
	                componentState: {
	                    module: 'boxplot',
	                    templateId: 'boxplotTemplate'	             
             		}
         		},{
                type: 'component',
                title: 'Correlations -SPLOM',
                componentName: 'angularModule',
                componentState: {
                    module: 'splom',
                    templateId: 'splomTemplate'
             }
	       },{
                type: 'component',
                title: 'Regressions',
                componentName: 'angularModule',
                componentState: {
                    module: 'regression',
                    templateId: 'regressionTemplate'
             }
	       }]
           }]
	   },{
	        type: 'column',
	        content: [{
                type: 'component',
                title: 'WHERE',
                componentName: 'angularModule',
                componentState: {
                    module: 'spatialviz',
                    templateId: 'spatioTemplate'
                }
            },{
                type: 'component',
                title: 'WHEN',
                componentName: 'angularModule',
                componentState: {
                    module: 'temporalviz',
                    templateId: 'temporalTemplate'
             }
           }]
	   }]
	   }]
	});
	myLayout.registerComponent( 'angularModule', AngularModuleComponent );
	myLayout.init();
</script>