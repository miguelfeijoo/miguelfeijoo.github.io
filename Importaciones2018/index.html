<!DOCTYPE html>
<meta charset="utf-8">

<svg width="960" height="600"></svg>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
var nodes = [
  { id: "Afganistan", label: "Afganistan", level: 2 },
  { id: "Alemania"   , label: "Alemania"   , level: 2 },
  { id: "Antillas Holandesas"   , label: "Antillas Holandesas"   , level: 2 },
  { id: "Argentina"   , label: "Argentina"  , level: 2 },
  { id: "Australia"   , label: "Australia"    , level: 2 },
  { id: "Austria", label: "Austria", level: 2 },
  { id: "Belgica"   , label: "Belgica"   , level: 2 },
  { id: "Bolivia"   , label: "Bolivia"   , level: 2 },
  { id: "Brasil"  , label: "Brasil"   , level: 2 },
  { id: "Canada"  , label: "Canada"   , level: 2 },
  { id: "Chile"  , label: "Chile"  , level: 2 },
  { id: "China", label: "China", level: 2 },
  { id: "Colombia"   , label: "Colombia"   , level: 1 },
  { id: "Corea"   , label: "Corea"   , level: 2 },
  { id: "Costa de Marfil"   , label: "Costa de Marfil"  , level: 2 },
  { id: "Costa Rica"   , label: "Costa Rica"    , level: 2 },
  { id: "Dinamarca", label: "Dinamarca", level: 2 },
  { id: "Ecuador"   , label: "Ecuador"   , level: 2 },
  { id: "El Salvador"   , label: "El Salvador"   , level: 2 },
  { id: "España"  , label: "España"   , level: 2 },
  { id: "Estados Unidos"  , label: "Estados Unidos"   , level: 2 },
  { id: "Filipinas"  , label: "Filipinas"  , level: 2 },
  { id: "Finlandia", label: "Finlandia", level: 2 },
  { id: "Francia"   , label: "Francia"   , level: 2 },
  { id: "Ghana"   , label: "Ghana"   , level: 2 },
  { id: "Guatemala"   , label: "Guatemala"  , level: 2 },
  { id: "Hong Kong"   , label: "Hong Kong"    , level: 2 },
  { id: "Hungria", label: "Hungria", level: 2 },
  { id: "India"   , label: "India"   , level: 2 },
  { id: "Indonesia"   , label: "Indonesia"   , level: 2 },
  { id: "Irlanda"  , label: "Irlanda"   , level: 2 },
  { id: "Israel"  , label: "Israel"   , level: 2 },
  { id: "Italia"  , label: "Italia"  , level: 2 },
  { id: "Japon", label: "Japon", level: 2 },
  { id: "Libano"   , label: "Libano"   , level: 2 },
  { id: "Malasia"   , label: "Malasia"   , level: 2 },
  { id: "Mexico"   , label: "Mexico"  , level: 2 },
  { id: "Nigeria"   , label: "Nigeria"    , level: 2 },
  { id: "Paises Bajos", label: "Paises Bajos", level: 2 },
  { id: "Pakistan"   , label: "Pakistan"   , level: 2 },
  { id: "Panama"   , label: "Panama"   , level: 2 },
  { id: "Peru"  , label: "Peru"   , level: 2 },
  { id: "Polonia"  , label: "Polonia"   , level: 2 },
  { id: "Portugal"  , label: "Portugal"  , level: 2 },
  { id: "Reino Unido", label: "Reino Unido", level: 2 },
  { id: "Republica Checa"   , label: "Republica Checa"   , level: 2 },
  { id: "Republica Dominicana"   , label: "Republica Dominicana"   , level: 2 },
  { id: "Reunion"   , label: "Reunion"  , level: 2 },
  { id: "Rumania"   , label: "Rumania"    , level: 2 },
  { id: "Serbia"   , label: "Serbia"   , level: 2 },
  { id: "Singapur"  , label: "Singapur"   , level: 2 },
  { id: "Suecia"  , label: "Suecia"   , level: 2 },
  { id: "Suiza"  , label: "Suiza"  , level: 2 },
  { id: "Taiwan, Provincia China", label: "Taiwan, Provincia China", level: 2 },
  { id: "Tokelau"   , label: "Tokelau"   , level: 2 },
  { id: "Trinidad y Tobago"   , label: "Trinidad y Tobago"   , level: 2 },
  { id: "Turquia"   , label: "Turquia"  , level: 2 },
  { id: "Uruguay"   , label: "Uruguay"    , level: 2 },
  { id: "Venezuela"  , label: "Venezuela"  , level: 2 },
  { id: "Vietnam", label: "Vietnam", level: 2 }, 
  { id: "Atlántico"  , label: "Atlántico"  , level: 1 },
  { id: "Antioquia"   , label: "Antioquia"   , level: 1 },
  { id: "Bogotá"   , label: "Bogotá"   , level: 1 },
  { id: "Cundinamarca"  , label: "Cundinamarca"   , level: 1 },
  { id: "Valle del Cauca"  , label: "Valle del Cauca"   , level: 1 },
  { id: "Caldas"  , label: "Caldas"  , level: 1 },
  { id: "Risaralda", label: "Risaralda", level: 1 },
  { id: "Nariño", label: "Nariño", level: 1 },
  { id: "Meta"   , label: "Meta"   , level: 1 },
  { id: "Cauca"   , label: "Cauca"   , level: 1 },
  { id: "La Guajira"   , label: "La Guajira"  , level: 1 },
  { id: "Bolívar"   , label: "Bolívar"    , level: 1 },
  { id: "Córdoba", label: "Córdoba", level: 1 },
  { id: "Tolima"   , label: "Tolima"   , level: 1 },
  { id: "Magdalena"   , label: "Magdalena"   , level: 1 },
  { id: "Santander"  , label: "Santander"   , level: 1 },
  { id: "Amazonas"  , label: "Amazonas"   , level: 1 },
  { id: "Putumayo"  , label: "Putumayo"  , level: 1 },
  { id: "San Andrés y Providencia", label: "San Andrés y Providencia", level: 1 },
  { id: "Huila"   , label: "Huila"   , level: 1 },
  { id: "Norte de Santander"   , label: "Norte de Santander"   , level: 1 },
  { id: "Cesar"   , label: "Cesar"  , level: 1 },
  { id: "Sucre"   , label: "Sucre"    , level: 1 },
  { id: "Quindío"   , label: "Quindío"   , level: 1 }
]
var links = [
  { target: "Antioquia", source: "Alemania" , strength: 0.5 },
  { target: "Bogotá", source: "Alemania" , strength: 0.5 },
  { target: "Cundinamarca", source: "Alemania" , strength: 0.5 },
  { target: "Bogotá", source: "Argentina" , strength: 0.5 },
  { target: "Bogotá", source: "Belgica" , strength: 0.5 },
  { target: "Valle del Cauca", source: "Belgica" , strength: 0.5 },
  { target: "Antioquia"  , source: "Brasil", strength: 0.5 },
  { target: "Bogotá"  , source: "Brasil", strength: 0.5 },
  { target: "Risaralda"  , source: "Brasil", strength: 0.5 },
  { target: "Cauca"  , source: "Brasil", strength: 0.5 },
  { target: "Valle del Cauca"  , source: "Brasil", strength: 0.5 },
  { target: "Bogotá"  , source: "Canada", strength: 0.5 },
  { target: "Cundinamarca"  , source: "Canada", strength: 0.5 }
]



function getNeighbors(node) {
  return links.reduce(function (neighbors, link) {
      if (link.target.id === node.id) {
        neighbors.push(link.source.id)
      } else if (link.source.id === node.id) {
        neighbors.push(link.target.id)
      }
      return neighbors
    },
    [node.id]
  )
}
function isNeighborLink(node, link) {
  return link.target.id === node.id || link.source.id === node.id
}
function getNodeColor(node, neighbors) {
  if (Array.isArray(neighbors) && neighbors.indexOf(node.id) > -1) {
    return node.level === 1 ? 'blue' : 'green'
  }
  return node.level === 1 ? 'red' : 'gray'
}
function getLinkColor(node, link) {
  return isNeighborLink(node, link) ? 'green' : '#E5E5E5'
}
function getTextColor(node, neighbors) {
  return Array.isArray(neighbors) && neighbors.indexOf(node.id) > -1 ? 'green' : 'black'
}
var width = window.innerWidth
var height = window.innerHeight
var svg = d3.select("body").append("svg");

var min_zoom = 0.1;
var max_zoom = 7;
var zoom = d3.behavior.zoom().scaleExtent([min_zoom,max_zoom])

svg.attr('width', width).attr('height', height)
// simulation setup with all forces
var linkForce = d3
  .forceLink()
  .id(function (link) { return link.id })
  .strength(function (link) { return link.strength })
var simulation = d3
  .forceSimulation()
  .force('link', linkForce)
  .force('charge', d3.forceManyBody().strength(-10))
  .force('center', d3.forceCenter(width/2, height/2))
var dragDrop = d3.drag().on('start', function (node) {
  node.fx = node.x
  node.fy = node.y
}).on('drag', function (node) {
  simulation.alphaTarget(0).restart()
  node.fx = d3.event.x
  node.fy = d3.event.y
}).on('end', function (node) {
  if (!d3.event.active) {
    simulation.alphaTarget(0)
  }
  node.fx = null
  node.fy = null
})
function selectNode(selectedNode) {
  var neighbors = getNeighbors(selectedNode)
  // we modify the styles to highlight selected nodes
  nodeElements.attr('fill', function (node) { return getNodeColor(node, neighbors) })
  textElements.attr('fill', function (node) { return getTextColor(node, neighbors) })
  linkElements.attr('stroke', function (link) { return getLinkColor(selectedNode, link) })
}
var linkElements = svg.append("g")
  .attr("class", "links")
  .selectAll("line")
  .data(links)
  .enter().append("line")
    .attr("stroke-width", 1)
    .attr("stroke", "rgba(50, 50, 50, 0.2)")
var nodeElements = svg.append("g")
  .attr("class", "nodes")
  .selectAll("circle")
  .data(nodes)
  .enter().append("circle")
    .attr("r", 10)
    .attr("fill", getNodeColor)
    .call(dragDrop)
    .on('click', selectNode)

nodeElements.on("dblclick.zoom", function(d) { d3.event.stopPropagation();
  var dcx = (window.innerWidth/2-d.x*zoom.scale());
  var dcy = (window.innerHeight/2-d.y*zoom.scale());
  zoom.translate([dcx,dcy]);
   g.attr("transform", "translate("+ dcx + "," + dcy  + ")scale(" + zoom.scale() + ")");
   
   
  });

  function resize() {
    var width = window.innerWidth, height = window.innerHeight;
  svg.attr("width", width).attr("height", height);
    
  force.size([force.size()[0]+(width-w)/zoom.scale(),force.size()[1]+(height-h)/zoom.scale()]).resume();
    w = width;
  h = height;
  }


var textElements = svg.append("g")
  .attr("class", "texts")
  .selectAll("text")
  .data(nodes)
  .enter().append("text")
    .text(function (node) { return  node.label })
    .attr("font-size", 10)
    .attr("dx", 15)
    .attr("dy", 4)

zoom.on("zoom", function() {
  
    var stroke = nominal_stroke;
    if (nominal_stroke*zoom.scale()>max_stroke) stroke = max_stroke/zoom.scale();
    link.style("stroke-width",stroke);
    circle.style("stroke-width",stroke);
     
  var base_radius = nominal_base_node_size;
    if (nominal_base_node_size*zoom.scale()>max_base_node_size) base_radius = max_base_node_size/zoom.scale();
        circle.attr("d", d3.svg.symbol()
        .size(function(d) { return Math.PI*Math.pow(size(d.size)*base_radius/nominal_base_node_size||base_radius,2); })
        .type(function(d) { return d.type; }))
    
  //circle.attr("r", function(d) { return (size(d.size)*base_radius/nominal_base_node_size||base_radius); })
  if (!text_center) text.attr("dx", function(d) { return (size(d.size)*base_radius/nominal_base_node_size||base_radius); });
  
  var text_size = nominal_text_size;
    if (nominal_text_size*zoom.scale()>max_text_size) text_size = max_text_size/zoom.scale();
    text.style("font-size",text_size + "px");

  g.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
  });
   
  svg.call(zoom);   
  
  resize();
  //window.focus();
  d3.select(window).on("resize", resize).on("keydown", keydown);

    
simulation.nodes(nodes).on('tick', () => {
  nodeElements
    .attr('cx', function (node) { return node.x })
    .attr('cy', function (node) { return node.y })
  textElements
    .attr('x', function (node) { return node.x })
    .attr('y', function (node) { return node.y })
  linkElements
    .attr('x1', function (link) { return link.source.x })
    .attr('y1', function (link) { return link.source.y })
    .attr('x2', function (link) { return link.target.x })
    .attr('y2', function (link) { return link.target.y })
})
simulation.force("link").links(links)
</script>